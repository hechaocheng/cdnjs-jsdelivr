if("undefined"==typeof jQuery)throw new Error("SlickGrid requires jquery module to be loaded");if(!jQuery.fn.drag)throw new Error("SlickGrid requires jquery.event.drag module to be loaded");!function($){function EditorLock(){var e=null;this.isActive=function(t){return t?e===t:null!==e},this.activate=function(t){if(t!==e){if(null!==e)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!t.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!t.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";e=t}},this.deactivate=function(t){if(e!==t)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";e=null},this.commitCurrentEdit=function(){return!e||e.commitCurrentEdit()},this.cancelCurrentEdit=function(){return!e||e.cancelCurrentEdit()}}function SlickGrid(container,data,columns,options){function init(){if($container=$(container),gridData=data,gridDataGetLength=gridData.getLength||defaultGetLength,gridDataGetItem=gridData.getItem||defaultGetItem,maxSupportedCssHeight=getMaxSupportedCssHeight(),scrollbarDimensions=scrollbarDimensions||measureScrollbar(),options=$.extend({},defaults,options),columnDefaults.width=options.defaultColumnWidth,options.enableColumnReorder&&!$.fn.sortable)throw new Error('SlickGrid\'s "enableColumnReorder = true" option requires jquery-ui.sortable module to be loaded');editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit},$container.empty().attr("tabIndex",0).attr("hideFocus",!0).css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget"),/relative|absolute|fixed/.test($container.css("position"))||$container.css("position","relative"),$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headers=$("<div class='slick-header-columns' style='width:100000px; left:-10000px' />").appendTo($headerScroller),$secondaryHeaderScroller=$("<div class='slick-header-secondary ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$secondaryHeaders=$("<div class='slick-header-columns-secondary' style='width:100000px' />").appendTo($secondaryHeaderScroller),options.showSecondaryHeaderRow||$secondaryHeaderScroller.hide(),$viewport=$("<div class='slick-viewport' tabIndex='0' hideFocus style='width:100%;overflow-x:auto;outline:0;position:relative;overflow-y:auto;'>").appendTo($container),$canvas=$("<div class='grid-canvas' tabIndex='0' hideFocus />").appendTo($viewport),measureCellPaddingAndBorder(),$viewport.height($container.innerHeight()-$headerScroller.outerHeight()-(options.showSecondaryHeaderRow?$secondaryHeaderScroller.outerHeight():0)),disableSelection($headers),$viewport.bind("selectstart.ui",function(e){return $(e.target).is("input,textarea")}),createColumnHeaders(),setupColumnSort(),setupDragEvents(),createCssRules(),resizeAndRender(),bindAncestorScrollEvents(),$viewport.bind("scroll.slickgrid",handleScroll),$container.bind("resize.slickgrid",resizeAndRender),$canvas.bind("keydown.slickgrid",handleKeyDown),$canvas.bind("click.slickgrid",handleClick),$canvas.bind("dblclick.slickgrid",handleDblClick),$canvas.bind("contextmenu.slickgrid",handleContextMenu),$canvas.bind("mouseover.slickgrid",handleHover),$headerScroller.bind("contextmenu.slickgrid",handleHeaderContextMenu),$headerScroller.bind("click.slickgrid",handleHeaderClick)}function measureScrollbar(){var e=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),t={width:e.width()-e[0].clientWidth,height:e.height()-e[0].clientHeight};return e.remove(),t}function setCanvasWidth(e){$canvas.width(e),viewportHasHScroll=e>viewportW-scrollbarDimensions.width}function disableSelection(e){e&&e.jquery&&e.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})}function defaultGetLength(){return gridData.length}function defaultGetItem(e){return gridData[e]}function getMaxSupportedCssHeight(){for(var e=0,t=$.browser.mozilla?5e6:1e9,o=$("<div style='display:none' />").appendTo(document.body);e<=t&&(o.css("height",e+1e6),o.height()===e+1e6);)e+=1e6;return o.remove(),e}function bindAncestorScrollEvents(){for(var e=$canvas[0];(e=e.parentNode)!=document.body;)e!=$viewport[0]&&e.scrollWidth==e.clientWidth&&e.scrollHeight==e.clientHeight||$(e).bind("scroll.slickgrid",handleCurrentCellPositionChange)}function unbindAncestorScrollEvents(){$canvas.parents().unbind("scroll.slickgrid")}function createColumnHeaders(){var e;for($headers.empty(),columnsById={},e=0;e<columns.length;e++){var t=columns[e]=$.extend({},columnDefaults,columns[e]);columnsById[t.id]=e;var o=$("<div class='ui-state-default slick-header-column' id='"+uid+t.id+"' />").html("<span class='slick-column-name'>"+t.name+"</span>").width((t.currentWidth||t.width)-headerColumnWidthDiff).attr("title",t.toolTip||t.name||"").data("fieldId",t.id).appendTo($headers);(options.enableColumnReorder||t.sortable)&&o.hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),t.sortable&&o.append("<span class='slick-sort-indicator' />")}setSortColumn(sortColumnId,sortAsc),setupColumnResize(),options.enableColumnReorder&&setupColumnReorder()}function setupColumnSort(){$headers.click(function(e){if(!$(e.target).hasClass("slick-resizable-handle")&&self.onSort){var t=$(e.target).closest(".slick-header-column");if(!t.length)return;var o=columns[getSiblingIndex(t[0])];if(o.sortable){if(!options.editorLock.commitCurrentEdit())return;o.id===sortColumnId?sortAsc=!sortAsc:(sortColumnId=o.id,sortAsc=!0),setSortColumn(sortColumnId,sortAsc),self.onSort(o,sortAsc)}}})}function setupColumnReorder(){$headers.sortable({containment:"parent",axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:!0,start:function(e,t){$(t.helper).addClass("slick-header-column-active")},beforeStop:function(e,t){$(t.helper).removeClass("slick-header-column-active")},stop:function(e){if(options.editorLock.commitCurrentEdit()){for(var t=$headers.sortable("toArray"),o=[],r=0;r<t.length;r++)o.push(columns[getColumnIndex(t[r].replace(uid,""))]);setColumns(o),self.onColumnsReordered&&self.onColumnsReordered(),e.stopPropagation(),setupColumnResize()}else $(this).sortable("cancel")}})}function setupColumnResize(){var e,t,o,r,n,l,i,s,a,d;(n=$headers.children()).find(".slick-resizable-handle").remove(),n.each(function(e,t){columns[e].resizable&&(void 0===s&&(s=e),a=e)}),n.each(function(c,u){void 0!==s&&c<s||options.forceFitColumns&&c>=a||(e=$(u),$("<div class='slick-resizable-handle' />").appendTo(u).bind("dragstart",function(e,s){if(!options.editorLock.commitCurrentEdit())return!1;r=e.pageX,$(this).parent().addClass("slick-header-column-active");var a=null,u=null;if(n.each(function(e,t){columns[e].previousWidth=$(t).outerWidth()}),options.forceFitColumns)for(a=0,u=0,t=c+1;t<n.length;t++)(o=columns[t]).resizable&&(null!==u&&(o.maxWidth?u+=o.maxWidth-o.previousWidth:u=null),a+=o.previousWidth-Math.max(o.minWidth||0,absoluteColumnMinWidth));var h=0,f=0;for(t=0;t<=c;t++)(o=columns[t]).resizable&&(null!==f&&(o.maxWidth?f+=o.maxWidth-o.previousWidth:f=null),h+=o.previousWidth-Math.max(o.minWidth||0,absoluteColumnMinWidth));null===a&&(a=1e5),null===h&&(h=1e5),null===u&&(u=1e5),null===f&&(f=1e5),i=r+Math.min(a,f),l=r-Math.min(h,u),d=$canvas.width()}).bind("drag",function(e,s){var a,u,h=Math.min(i,Math.max(l,e.pageX))-r;if(h<0){for(u=h,t=c;t>=0;t--)(o=columns[t]).resizable&&(a=Math.max(o.minWidth||0,absoluteColumnMinWidth),u&&o.previousWidth+u<a?(u+=o.previousWidth-a,styleColumnWidth(t,a,options.syncColumnCellResize)):(styleColumnWidth(t,o.previousWidth+u,options.syncColumnCellResize),u=0));if(options.forceFitColumns)for(u=-h,t=c+1;t<n.length;t++)(o=columns[t]).resizable&&(u&&o.maxWidth&&o.maxWidth-o.previousWidth<u?(u-=o.maxWidth-o.previousWidth,styleColumnWidth(t,o.maxWidth,options.syncColumnCellResize)):(styleColumnWidth(t,o.previousWidth+u,options.syncColumnCellResize),u=0));else options.syncColumnCellResize&&setCanvasWidth(d+h)}else{for(u=h,t=c;t>=0;t--)(o=columns[t]).resizable&&(u&&o.maxWidth&&o.maxWidth-o.previousWidth<u?(u-=o.maxWidth-o.previousWidth,styleColumnWidth(t,o.maxWidth,options.syncColumnCellResize)):(styleColumnWidth(t,o.previousWidth+u,options.syncColumnCellResize),u=0));if(options.forceFitColumns)for(u=-h,t=c+1;t<n.length;t++)(o=columns[t]).resizable&&(a=Math.max(o.minWidth||0,absoluteColumnMinWidth),u&&o.previousWidth+u<a?(u+=o.previousWidth-a,styleColumnWidth(t,a,options.syncColumnCellResize)):(styleColumnWidth(t,o.previousWidth+u,options.syncColumnCellResize),u=0));else options.syncColumnCellResize&&setCanvasWidth(d+h)}}).bind("dragend",function(e,r){var l;for($(this).parent().removeClass("slick-header-column-active"),t=0;t<n.length;t++)o=columns[t],l=$(n[t]).outerWidth(),o.previousWidth!==l&&o.rerenderOnResize&&removeAllRows(),options.forceFitColumns?o.width=Math.floor(o.width*(l-o.previousWidth)/o.previousWidth)+o.width:o.width=l,options.syncColumnCellResize||o.previousWidth===l||styleColumnWidth(t,l,!0);resizeCanvas(),self.onColumnsResized&&self.onColumnsResized()}))})}function setupDragEvents(){function e(e){return{start:{row:Math.min(e.start.row,e.end.row),cell:Math.min(e.start.cell,e.end.cell)},end:{row:Math.max(e.start.row,e.end.row),cell:Math.max(e.start.cell,e.end.cell)}}}$canvas.bind("draginit",function(e,t){var o=$(e.target).closest(".slick-cell");if(0===o.length)return!1;if(parseInt(o.parent().attr("row"),10)>=gridDataGetLength())return!1;var r=columns[getSiblingIndex(o[0])];if("move"==r.behavior||"selectAndMove"==r.behavior)t.mode=1;else{if(!options.enableCellRangeSelection)return!1;t.mode=2}}).bind("dragstart",function(e,t){if(!options.editorLock.commitCurrentEdit())return!1;var o=parseInt($(e.target).closest(".slick-row").attr("row"),10);if(1==t.mode&&(selectedRowsLookup[o]||setSelectedRows([o]),t.selectionProxy=$("<div class='slick-reorder-proxy'/>").css("position","absolute").css("zIndex","99999").css("width",$(this).innerWidth()).css("height",options.rowHeight*selectedRows.length).appendTo($viewport),t.guide=$("<div class='slick-reorder-guide'/>").css("position","absolute").css("zIndex","99998").css("width",$(this).innerWidth()).css("top",-1e3).appendTo($viewport),t.insertBefore=-1),2==t.mode){var r=getCellFromPoint(t.startX-$canvas.offset().left,t.startY-$canvas.offset().top);return!!cellExists(r.row,r.cell)&&(t.range={start:r,end:{}},$("<div class='slick-selection'></div>").appendTo($canvas))}}).bind("drag",function(t,o){if(1==o.mode){var r=t.pageY-$(this).offset().top;o.selectionProxy.css("top",r-5);var n=Math.max(0,Math.min(Math.round(r/options.rowHeight),gridDataGetLength()));n!==o.insertBefore&&(self.onBeforeMoveRows&&!1===self.onBeforeMoveRows(getSelectedRows(),n)?(o.guide.css("top",-1e3),o.canMove=!1):(o.guide.css("top",n*options.rowHeight),o.canMove=!0),o.insertBefore=n)}if(2==o.mode){var l=getCellFromPoint(t.clientX-$canvas.offset().left,t.clientY-$canvas.offset().top);if(!cellExists(l.row,l.cell))return;o.range.end=l;var i=e(o.range),s=getCellNodeBox(i.start.row,i.start.cell),a=getCellNodeBox(i.end.row,i.end.cell);$(o.proxy).css({top:s.top,left:s.left,height:a.bottom-s.top-2,width:a.right-s.left-2})}}).bind("dragend",function(t,o){1==o.mode&&(o.guide.remove(),o.selectionProxy.remove(),self.onMoveRows&&o.canMove&&self.onMoveRows(getSelectedRows(),o.insertBefore)),2==o.mode&&($(o.proxy).remove(),self.onCellRangeSelected&&self.onCellRangeSelected(e(o.range)))})}function measureCellPaddingAndBorder(){var e=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers);headerColumnWidthDiff=e.outerWidth()-e.width(),headerColumnHeightDiff=e.outerHeight()-e.height(),e.remove();var t=$("<div class='slick-row' />").appendTo($canvas);e=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(t),cellWidthDiff=e.outerWidth()-e.width(),cellHeightDiff=e.outerHeight()-e.height(),t.remove(),absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));for(var e=options.rowHeight-cellHeightDiff,t=["."+uid+" .slick-header-column { left: 10000px; }","."+uid+" .slick-header-columns-secondary {  height:"+options.secondaryHeaderRowHeight+"px; }","."+uid+" .slick-cell { height:"+e+"px; }"],o=0;o<columns.length;o++)t.push("."+uid+" .c"+o+" { width:"+((columns[o].currentWidth||columns[o].width)-cellWidthDiff)+"px;  } ");$style[0].styleSheet?$style[0].styleSheet.cssText=t.join(""):$style[0].appendChild(document.createTextNode(t.join(" ")));for(var r=document.styleSheets,o=0;o<r.length;o++)if((r[o].ownerNode||r[o].owningElement)==$style[0]){stylesheet=r[o];break}}function findCssRule(e){for(var t=stylesheet.cssRules||stylesheet.rules,o=0;o<t.length;o++)if(t[o].selectorText==e)return t[o];return null}function findCssRuleForCell(e){return findCssRule("."+uid+" .c"+e)}function removeCssRules(){$style.remove()}function destroy(){options.editorLock.cancelCurrentEdit(),self.onBeforeDestroy&&self.onBeforeDestroy(),options.enableColumnReorder&&$headers.sortable&&$headers.sortable("destroy"),unbindAncestorScrollEvents(),$container.unbind(".slickgrid"),removeCssRules(),$canvas.unbind("draginit dragstart dragend drag"),$container.empty().removeClass(uid)}function getEditController(){return editController}function getColumnIndex(e){return columnsById[e]}function autosizeColumns(){var e,t,o=[],r=0,n=$viewport.innerWidth(),l=options.autoHeight?n:n-scrollbarDimensions.width,i=0,s=0;for(e=0;e<columns.length;e++)t=columns[e],o.push(t.width),s+=t.width,r+=t.width-Math.max(t.minWidth||0,absoluteColumnMinWidth);for(i=s,removeAllRows();i>l;){if(!r)return;var a=(i-l)/r;for(e=0;e<columns.length&&i>l;e++)if((t=columns[e]).resizable&&t.minWidth!==t.width&&t.width!==absoluteColumnMinWidth){var d=Math.floor(a*(t.width-Math.max(t.minWidth||0,absoluteColumnMinWidth)))||1;i-=d,o[e]-=d}}for(var c=i;i<l;){var u=l/i;for(e=0;e<columns.length&&i<l;e++)if((t=columns[e]).resizable&&!(t.maxWidth<=t.width)){var h=Math.min(Math.floor(u*t.width)-t.width,t.maxWidth-t.width||1e6)||1;i+=h,o[e]+=h}if(c==i)break;c=i}for(e=0;e<columns.length;e++)styleColumnWidth(e,columns[e].currentWidth=o[e],!0);resizeCanvas()}function styleColumnWidth(e,t,o){columns[e].currentWidth=t,$headers.children().eq(e).css("width",t-headerColumnWidthDiff),o&&(findCssRuleForCell(e).style.width=t-cellWidthDiff+"px")}function setSortColumn(e,t){sortAsc=t;var o=getColumnIndex(sortColumnId=e);$headers.children().removeClass("slick-header-column-sorted"),$headers.find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),null!=o&&$headers.children().eq(o).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")}function getSelectedRows(){return selectedRows.concat()}function setSelectedRows(e){var t,o,r={};for(t=0;t<e.length;t++)r[e[t]]=!0;for(t=0;t<selectedRows.length;t++)o=selectedRows[t],rowsCache[o]&&!r[o]&&$(rowsCache[o]).removeClass("ui-state-active selected");for(t=0;t<e.length;t++)o=e[t],rowsCache[o]&&!selectedRowsLookup[o]&&$(rowsCache[o]).addClass("ui-state-active selected");selectedRows=e.concat(),selectedRowsLookup=r}function getColumns(){return columns}function setColumns(e){columns=e,removeAllRows(),createColumnHeaders(),removeCssRules(),createCssRules(),resizeAndRender(),handleScroll()}function getOptions(){return options}function setOptions(e){options.editorLock.commitCurrentEdit()&&(makeSelectedCellNormal(),options.enableAddRow!==e.enableAddRow&&removeRow(gridDataGetLength()),options=$.extend(options,e),render())}function setData(e,t){removeAllRows(),gridDataGetLength=(gridData=data=e).getLength||defaultGetLength,gridDataGetItem=gridData.getItem||defaultGetItem,t&&scrollTo(0)}function getData(){return gridData}function getSecondaryHeaderRow(){return $secondaryHeaders[0]}function showSecondaryHeaderRow(){options.showSecondaryHeaderRow=!0,$secondaryHeaderScroller.slideDown("fast",resizeCanvas)}function hideSecondaryHeaderRow(){options.showSecondaryHeaderRow=!1,$secondaryHeaderScroller.slideUp("fast",resizeCanvas)}function scrollTo(e){var t=offset;page=Math.min(n-1,Math.floor(e/ph));var o=e-(offset=Math.round(page*cj));if(offset!=t){var r=getVisibleRange(o);cleanupRows(r.top,r.bottom),updateRowPositions()}prevScrollTop!=o&&(scrollDir=prevScrollTop+t<o+offset?1:-1,$viewport[0].scrollTop=lastRenderedScrollTop=scrollTop=prevScrollTop=o,self.onViewportChanged&&self.onViewportChanged())}function defaultFormatter(e,t,o,r,n){return null===o||void 0===o?"":o}function getFormatter(e){return e.formatter||options.formatterFactory&&options.formatterFactory.getFormatter(e)||defaultFormatter}function getEditor(e){return e.editor||options.editorFactory&&options.editorFactory.getEditor(e)}function appendRowHtml(e,t){var o,r=gridDataGetItem(t),n="slick-row "+(t<gridDataGetLength()&&!r?" loading":"")+(selectedRowsLookup[t]?" selected ui-state-active":"")+(t%2==1?" odd":" even");options.rowCssClasses&&(n+=" "+options.rowCssClasses(r)),e.push("<div class='ui-widget-content "+n+"' row='"+t+"' style='top:"+(options.rowHeight*t-offset)+"px'>");for(var l=0,i=columns.length;l<i;l++){var s=columns[l];o="slick-cell c"+l+(s.cssClass?" "+s.cssClass:""),highlightedCells&&highlightedCells[t]&&highlightedCells[t][s.id]&&(o+=" "+options.cellHighlightCssClass),e.push("<div class='"+o+"'>"),r&&e.push(getFormatter(s)(t,l,r[s.field],s,r)),e.push("</div>")}e.push("</div>")}function cleanupRows(e){for(var t in rowsCache)(t=parseInt(t,10))!==currentRow&&(t<e.top||t>e.bottom)&&removeRowFromCache(t)}function invalidate(){updateRowCount(),removeAllRows(),render()}function removeAllRows(){currentEditor&&makeSelectedCellNormal(),$canvas[0].innerHTML="",rowsCache={},postProcessedRows={},counter_rows_removed+=renderedRows,renderedRows=0}function removeRowFromCache(e){var t=rowsCache[e];t&&($canvas[0].removeChild(t),delete rowsCache[e],delete postProcessedRows[e],renderedRows--,counter_rows_removed++)}function removeRows(e){var t,o,r;if(e&&e.length){scrollDir=0;var n=[];for(t=0,o=e.length;t<o;t++)currentEditor&&currentRow===t&&makeSelectedCellNormal(),rowsCache[e[t]]&&n.push(e[t]);if(renderedRows>10&&n.length===renderedRows)removeAllRows();else for(t=0,r=n.length;t<r;t++)removeRowFromCache(n[t])}}function removeRow(e){removeRows([e])}function updateCell(e,t){if(rowsCache[e]){var o=$(rowsCache[e]).children().eq(t);if(0!==o.length){var r=columns[t],n=gridDataGetItem(e);currentEditor&&currentRow===e&&currentCell===t?currentEditor.loadValue(n):(o[0].innerHTML=n?getFormatter(r)(e,t,n[r.field],r,n):"",invalidatePostProcessingResults(e))}}}function updateRow(e){rowsCache[e]&&($(rowsCache[e]).children().each(function(t){var o=columns[t];e===currentRow&&t===currentCell&&currentEditor?currentEditor.loadValue(gridDataGetItem(currentRow)):gridDataGetItem(e)?this.innerHTML=getFormatter(o)(e,t,gridDataGetItem(e)[o.field],o,gridDataGetItem(e)):this.innerHTML=""}),invalidatePostProcessingResults(e))}function resizeCanvas(){var e=options.rowHeight*(gridDataGetLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0));options.autoHeight?$viewport.height(e):$viewport.height($container.innerHeight()-$headerScroller.outerHeight()-(options.showSecondaryHeaderRow?$secondaryHeaderScroller.outerHeight():0)),viewportW=$viewport.innerWidth(),viewportH=$viewport.innerHeight(),numVisibleRows=Math.ceil(viewportH/options.rowHeight);var t=0;$headers.find(".slick-header-column").each(function(){t+=$(this).outerWidth()}),setCanvasWidth(t),updateRowCount(),render()}function resizeAndRender(){options.forceFitColumns?autosizeColumns():resizeCanvas()}function updateRowCount(){var e=gridDataGetLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0),t=h,o=options.enableAddRow?gridDataGetLength():gridDataGetLength()-1;for(var r in rowsCache)r>=o&&removeRowFromCache(r);(th=Math.max(options.rowHeight*e,viewportH-scrollbarDimensions.height))<maxSupportedCssHeight?(h=ph=th,n=1,cj=0):(ph=(h=maxSupportedCssHeight)/100,n=Math.floor(th/ph),cj=(th-h)/(n-1)),h!==t&&($canvas.css("height",h),scrollTop=$viewport[0].scrollTop);var l=scrollTop+offset<=th-viewportH;0==th||0==scrollTop?page=offset=0:scrollTo(l?scrollTop+offset:th-viewportH),h!=t&&options.autoHeight&&resizeCanvas()}function getVisibleRange(e){return null==e&&(e=scrollTop),{top:Math.floor((scrollTop+offset)/options.rowHeight),bottom:Math.ceil((scrollTop+offset+viewportH)/options.rowHeight)}}function getRenderedRange(e){var t=getVisibleRange(e),o=Math.round(viewportH/options.rowHeight);return-1==scrollDir?(t.top-=o,t.bottom+=3):1==scrollDir?(t.top-=3,t.bottom+=o):(t.top-=3,t.bottom+=3),t.top=Math.max(0,t.top),t.bottom=Math.min(options.enableAddRow?gridDataGetLength():gridDataGetLength()-1,t.bottom),t}function renderRows(e){var t,o,r=$canvas[0],n=renderedRows,l=[],i=[],s=new Date,a=!1;for(t=e.top;t<=e.bottom;t++)rowsCache[t]||(renderedRows++,i.push(t),appendRowHtml(l,t),currentCellNode&&currentRow===t&&(a=!0),counter_rows_rendered++);var d=document.createElement("div");for(d.innerHTML=l.join(""),t=0,o=d.childNodes.length;t<o;t++)rowsCache[i[t]]=r.appendChild(d.firstChild);a&&setSelectedCell(currentCellNode=$(rowsCache[currentRow]).children().eq(currentCell)[0],!1),renderedRows-n>5&&(avgRowRenderTime=(new Date-s)/(renderedRows-n))}function startPostProcessing(){options.enableAsyncPostRender&&(clearTimeout(h_postrender),h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}function invalidatePostProcessingResults(e){delete postProcessedRows[e],postProcessFromRow=Math.min(postProcessFromRow,e),postProcessToRow=Math.max(postProcessToRow,e),startPostProcessing()}function updateRowPositions(){for(var e in rowsCache)rowsCache[e].style.top=e*options.rowHeight-offset+"px"}function render(){var e=getVisibleRange(),t=getRenderedRange();cleanupRows(t),renderRows(t),postProcessFromRow=e.top,postProcessToRow=Math.min(options.enableAddRow?gridDataGetLength():gridDataGetLength()-1,e.bottom),startPostProcessing(),lastRenderedScrollTop=scrollTop,h_render=null}function handleScroll(){scrollTop=$viewport[0].scrollTop;var e=$viewport[0].scrollLeft,t=Math.abs(scrollTop-prevScrollTop);if(e!==prevScrollLeft&&(prevScrollLeft=e,$headerScroller[0].scrollLeft=e,$secondaryHeaderScroller[0].scrollLeft=e),t){if(scrollDir=prevScrollTop<scrollTop?1:-1,prevScrollTop=scrollTop,t<viewportH)scrollTo(scrollTop+offset);else{var o=offset;page=Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph))),o!=(offset=Math.round(page*cj))&&removeAllRows()}h_render&&clearTimeout(h_render),Math.abs(lastRenderedScrollTop-scrollTop)<viewportH?render():h_render=setTimeout(render,50),self.onViewportChanged&&self.onViewportChanged()}}function asyncPostProcessRows(){for(;postProcessFromRow<=postProcessToRow;){var e=scrollDir>=0?postProcessFromRow++:postProcessToRow--,t=rowsCache[e];if(!(!t||postProcessedRows[e]||e>=gridDataGetLength())){for(var o=gridDataGetItem(e),r=t.childNodes,n=0,l=0,i=columns.length;n<i;++n){var s=columns[n];s.asyncPostRender&&s.asyncPostRender(r[l],postProcessFromRow,o,s),++l}return postProcessedRows[e]=!0,void(h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}}}function setHighlightedCells(e){var t,o;for(var r in rowsCache)for(t=0;t<columns.length;t++)(highlightedCells&&highlightedCells[r]&&highlightedCells[r][columns[t].id])!=(e&&e[r]&&e[r][columns[t].id])&&(o=$(rowsCache[r]).children().eq(t)).length&&o.toggleClass(options.cellHighlightCssClass);highlightedCells=e}function flashCell(e,t,o){function r(e){e&&setTimeout(function(){n.queue(function(){n.toggleClass(options.cellFlashingCssClass).dequeue(),r(e-1)})},o)}if(o=o||100,rowsCache[e]){var n=$(rowsCache[e]).children().eq(t);r(4)}}function getSiblingIndex(e){for(var t=0;e&&e.previousSibling;)t++,e=e.previousSibling;return t}function handleKeyDown(e){if(!(self.onKeyDown&&!options.editorLock.isActive()&&self.onKeyDown(e,currentRow,currentCell)))if(e.shiftKey||e.altKey||e.ctrlKey){if(9!=e.which||!e.shiftKey||e.ctrlKey||e.altKey)return;navigatePrev()}else if(27==e.which){if(!options.editorLock.isActive())return;cancelEditAndSetFocus()}else if(37==e.which)navigateLeft();else if(39==e.which)navigateRight();else if(38==e.which)navigateUp();else if(40==e.which)navigateDown();else if(9==e.which)navigateNext();else{if(13!=e.which)return;options.editable&&(currentEditor?currentRow===defaultGetLength()?navigateDown():commitEditAndSetFocus():options.editorLock.commitCurrentEdit()&&makeSelectedCellEditable())}e.stopPropagation(),e.preventDefault();try{e.originalEvent.keyCode=0}catch(e){}}function handleClick(e){var t=$(e.target).closest(".slick-cell",$canvas);if(0!==t.length&&(currentCellNode!==t[0]||null===currentEditor)){var o=parseInt(t.parent().attr("row"),10),r=getSiblingIndex(t[0]),n=null,l=columns[r],i=gridDataGetItem(o);if(i&&("selectAndMove"===l.behavior||"select"===l.behavior||e.ctrlKey||e.shiftKey)&&(n=options.editorLock.commitCurrentEdit())){var s=getSelectedRows(),a=$.inArray(o,s);if(e.ctrlKey||e.shiftKey||e.metaKey){if(options.multiSelect)if(-1===a&&(e.ctrlKey||e.metaKey))s.push(o);else if(-1!==a&&(e.ctrlKey||e.metaKey))s=$.grep(s,function(e,t){return e!==o});else if(s.length&&e.shiftKey){var d=s.pop(),c=Math.min(o,d),u=Math.max(o,d);s=[];for(var h=c;h<=u;h++)h!==d&&s.push(h);s.push(d)}}else s=[o];return resetCurrentCell(),setSelectedRows(s),self.onSelectedRowsChanged&&self.onSelectedRowsChanged(),$.browser.msie||$canvas[0].focus(),!1}if(i&&self.onClick&&(n=options.editorLock.commitCurrentEdit())&&self.onClick(e,o,r))return e.stopPropagation(),e.preventDefault(),!1;options.enableCellNavigation&&!columns[r].unselectable&&(!0===n||null===n&&options.editorLock.commitCurrentEdit())&&(scrollRowIntoView(o,!1),setSelectedCellAndRow(t[0],o===defaultGetLength()||options.autoEdit))}}function handleContextMenu(e){var t=$(e.target).closest(".slick-cell",$canvas);if(0!==t.length&&(currentCellNode!==t[0]||null===currentEditor)){var o=parseInt(t.parent().attr("row"),10),r=getSiblingIndex(t[0]);return gridDataGetItem(o)&&self.onContextMenu&&options.editorLock.commitCurrentEdit()&&self.onContextMenu(e,o,r)?(e.stopPropagation(),e.preventDefault(),!1):void 0}}function handleDblClick(e){var t=$(e.target).closest(".slick-cell",$canvas);if(0!==t.length&&(currentCellNode!==t[0]||null===currentEditor)){var o=parseInt(t.parent().attr("row"),10),r=getSiblingIndex(t[0]);if(gridDataGetItem(o)&&self.onDblClick&&options.editorLock.commitCurrentEdit()&&self.onDblClick(e,o,r))return e.stopPropagation(),e.preventDefault(),!1;options.editable&&gotoCell(o,r,!0)}}function handleHeaderContextMenu(e){if(self.onHeaderContextMenu&&options.editorLock.commitCurrentEdit()){e.preventDefault();var t=$(e.target).closest(".slick-header-column",".slick-header-columns");self.onHeaderContextMenu(e,columns[self.getColumnIndex(t.data("fieldId"))])}}function handleHeaderClick(e){var t=$(e.target).closest(".slick-header-column");if(0!=t.length){var o=columns[getSiblingIndex(t[0])];self.onHeaderClick&&options.editorLock.commitCurrentEdit()&&(e.preventDefault(),self.onHeaderClick(e,o))}}function handleHover(e){if(options.enableAutoTooltips){var t=$(e.target).closest(".slick-cell",$canvas);if(t.length)if(t.innerWidth()<t[0].scrollWidth){var o=$.trim(t.text());t.attr("title",options.toolTipMaxLength&&o.length>options.toolTipMaxLength?o.substr(0,options.toolTipMaxLength-3)+"...":o)}else t.attr("title","")}}function cellExists(e,t){return!(e<0||e>=gridDataGetLength()||t<0||t>=columns.length)}function getCellFromPoint(e,t){for(var o=Math.floor((t+offset)/options.rowHeight),r=0,n=0,l=0;l<columns.length&&n<e;l++)n+=columns[l].width,r++;return{row:o,cell:r-1}}function getCellFromEvent(e){var t=$(e.target).closest(".slick-cell",$canvas);return t.length?{row:0|t.parent().attr("row"),cell:getSiblingIndex(t[0])}:null}function getCellNodeBox(e,t){if(!cellExists(e,t))return null;for(var o=e*options.rowHeight-offset,r=o+options.rowHeight-1,n=0,l=0;l<t;l++)n+=columns[l].width;return{top:o,left:n,bottom:r,right:n+columns[t].width}}function resetCurrentCell(){setSelectedCell(null,!1)}function focusOnCurrentCell(){$(currentCellNode).attr("tabIndex",0).attr("hideFocus",!0),$.browser.msie&&parseInt($.browser.version)<8?currentCellNode.setActive():currentCellNode.focus();var e=$(currentCellNode).position().left,t=e+$(currentCellNode).outerWidth(),o=$viewport.scrollLeft(),r=o+$viewport.width();e<o?$viewport.scrollLeft(e):t>r&&$viewport.scrollLeft(Math.min(e,t-$viewport[0].clientWidth))}function setSelectedCell(e,t){null!==currentCellNode&&(makeSelectedCellNormal(),$(currentCellNode).removeClass("selected")),null!=(currentCellNode=e)?(currentRow=parseInt($(currentCellNode).parent().attr("row"),10),currentCell=getSiblingIndex(currentCellNode),$(currentCellNode).addClass("selected"),options.editable&&t&&isCellPotentiallyEditable(currentRow,currentCell)?(clearTimeout(h_editorLoader),options.asyncEditorLoading?h_editorLoader=setTimeout(makeSelectedCellEditable,options.asyncEditorLoadDelay):makeSelectedCellEditable()):focusOnCurrentCell(),self.onCurrentCellChanged&&self.onCurrentCellChanged(getCurrentCell())):(currentRow=null,currentCell=null)}function setSelectedCellAndRow(e,t){setSelectedCell(e,t),setSelectedRows(e?[currentRow]:[]),self.onSelectedRowsChanged&&self.onSelectedRowsChanged()}function clearTextSelection(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}}function isCellPotentiallyEditable(e,t){return!(e<gridDataGetLength()&&!gridDataGetItem(e))&&(!(columns[t].cannotTriggerInsert&&e>=gridDataGetLength())&&!!getEditor(columns[t]))}function makeSelectedCellNormal(){if(currentEditor){if(self.onBeforeCellEditorDestroy&&self.onBeforeCellEditorDestroy(currentEditor),currentEditor.destroy(),currentEditor=null,currentCellNode&&($(currentCellNode).removeClass("editable invalid"),gridDataGetItem(currentRow))){var e=columns[currentCell];currentCellNode.innerHTML=getFormatter(e)(currentRow,currentCell,gridDataGetItem(currentRow)[e.field],e,gridDataGetItem(currentRow)),invalidatePostProcessingResults(currentRow)}$.browser.msie&&clearTextSelection(),options.editorLock.deactivate(editController)}}function makeSelectedCellEditable(){if(currentCellNode){if(!options.editable)throw"Grid : makeSelectedCellEditable : should never get called when options.editable is false";if(clearTimeout(h_editorLoader),isCellPotentiallyEditable(currentRow,currentCell))if(self.onBeforeEditCell&&!1===self.onBeforeEditCell(currentRow,currentCell,gridDataGetItem(currentRow)))focusOnCurrentCell();else{options.editorLock.activate(editController),$(currentCellNode).addClass("editable"),currentCellNode.innerHTML="";var e=columns[currentCell],t=gridDataGetItem(currentRow);currentEditor=new(getEditor(e))({grid:self,gridPosition:absBox($container[0]),position:absBox(currentCellNode),container:currentCellNode,column:e,item:t||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus}),t&&currentEditor.loadValue(t),serializedEditorValue=currentEditor.serializeValue(),currentEditor.position&&handleCurrentCellPositionChange()}}}function commitEditAndSetFocus(){options.editorLock.commitCurrentEdit()&&(focusOnCurrentCell(),options.autoEdit&&navigateDown())}function cancelEditAndSetFocus(){options.editorLock.cancelCurrentEdit()&&focusOnCurrentCell()}function absBox(e){var t={top:e.offsetTop,left:e.offsetLeft,bottom:0,right:0,width:$(e).outerWidth(),height:$(e).outerHeight(),visible:!0};t.bottom=t.top+t.height,t.right=t.left+t.width;for(var o=e.offsetParent;(e=e.parentNode)!=document.body;)t.visible&&e.scrollHeight!=e.offsetHeight&&"visible"!=$(e).css("overflowY")&&(t.visible=t.bottom>e.scrollTop&&t.top<e.scrollTop+e.clientHeight),t.visible&&e.scrollWidth!=e.offsetWidth&&"visible"!=$(e).css("overflowX")&&(t.visible=t.right>e.scrollLeft&&t.left<e.scrollLeft+e.clientWidth),t.left-=e.scrollLeft,t.top-=e.scrollTop,e===o&&(t.left+=e.offsetLeft,t.top+=e.offsetTop,o=e.offsetParent),t.bottom=t.top+t.height,t.right=t.left+t.width;return t}function getCurrentCellPosition(){return absBox(currentCellNode)}function getGridPosition(){return absBox($container[0])}function handleCurrentCellPositionChange(){if(currentCellNode){var e;self.onCurrentCellPositionChanged&&(e=getCurrentCellPosition(),self.onCurrentCellPositionChanged(e)),currentEditor&&(e=e||getCurrentCellPosition(),currentEditor.show&&currentEditor.hide&&(e.visible?currentEditor.show():currentEditor.hide()),currentEditor.position&&currentEditor.position(e))}}function getCellEditor(){return currentEditor}function getCurrentCell(){return currentCellNode?{row:currentRow,cell:currentCell}:null}function getCurrentCellNode(){return currentCellNode}function scrollRowIntoView(e,t){var o=e*options.rowHeight,r=(e+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);(e+1)*options.rowHeight>scrollTop+viewportH+offset?(scrollTo(t?o:r),render()):e*options.rowHeight<scrollTop+offset&&(scrollTo(t?r:o),render())}function gotoDir(e,t,o){function r(){return!columns[getSiblingIndex(this)].unselectable}if(currentCellNode&&options.enableCellNavigation&&options.editorLock.commitCurrentEdit()){var n=rowsCache[currentRow+e],l=n&&currentCell+t>=0?$(n).children().eq(currentCell+t).filter(r):null;if(l&&!l.length&&(i=$(n).children().filter(function(e){return t>0?e>currentCell+t:e<currentCell+t}).filter(r))&&i.length&&(l=t>0?i.eq(0):i.eq(i.length-1)),o&&0===e&&!(n&&l&&l.length)&&(!l||!l.length)){n=rowsCache[currentRow+e+(t>0?1:-1)];var i=$(n).children().filter(r);l=t>0?n?i.eq(0):null:n?i.eq(i.length-1):null}if(n&&l&&l.length){var s=parseInt($(n).attr("row"),10),a=s==defaultGetLength();scrollRowIntoView(s,!a),setSelectedCellAndRow(l[0],a||options.autoEdit),currentEditor||focusOnCurrentCell()}else focusOnCurrentCell()}}function gotoCell(e,t,o){if(!(e>gridDataGetLength()||e<0||t>=columns.length||t<0)&&options.enableCellNavigation&&!columns[t].unselectable&&options.editorLock.commitCurrentEdit()){scrollRowIntoView(e,!1);var r=null;columns[t].unselectable||(r=$(rowsCache[e]).children().eq(t)[0]),setSelectedCellAndRow(r,o||e===gridDataGetLength()||options.autoEdit),currentEditor||focusOnCurrentCell()}}function navigateUp(){gotoDir(-1,0,!1)}function navigateDown(){gotoDir(1,0,!1)}function navigateLeft(){gotoDir(0,-1,!1)}function navigateRight(){gotoDir(0,1,!1)}function navigatePrev(){gotoDir(0,-1,!0)}function navigateNext(){gotoDir(0,1,!0)}function commitCurrentEdit(){var e=gridDataGetItem(currentRow),t=columns[currentCell];if(currentEditor){if(currentEditor.isValueChanged()){var o=currentEditor.validate();if(o.valid){if(currentRow<gridDataGetLength()){var r={row:currentRow,cell:currentCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(e,this.serializedValue),updateRow(this.row)},undo:function(){this.editor.applyValue(e,this.prevSerializedValue),updateRow(this.row)}};options.editCommandHandler?(makeSelectedCellNormal(),options.editCommandHandler(e,t,r)):(r.execute(),makeSelectedCellNormal()),self.onCellChange&&self.onCellChange(currentRow,currentCell,e)}else if(self.onAddNewRow){var n={};currentEditor.applyValue(n,currentEditor.serializeValue()),makeSelectedCellNormal(),self.onAddNewRow(n,t)}return!options.editorLock.isActive()}return $(currentCellNode).addClass("invalid"),$(currentCellNode).stop(!0,!0).effect("highlight",{color:"red"},300),self.onValidationError&&self.onValidationError(currentCellNode,o,currentRow,currentCell,t),currentEditor.focus(),!1}makeSelectedCellNormal()}return!0}function cancelCurrentEdit(){return makeSelectedCellNormal(),!0}var defaults={rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,enableCellNavigation:!0,enableCellRangeSelection:!1,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:60,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showSecondaryHeaderRow:!1,secondaryHeaderRowHeight:25,syncColumnCellResize:!1,enableAutoTooltips:!0,toolTipMaxLength:null,formatterFactory:null,editorFactory:null,cellHighlightCssClass:"highlighted",cellFlashingCssClass:"flashing",multiSelect:!0},gridData,gridDataGetLength,gridDataGetItem,columnDefaults={name:"",resizable:!0,sortable:!1,minWidth:30},maxSupportedCssHeight,th,h,ph,n,cj,page=0,offset=0,scrollDir=1,$container,uid="slickgrid_"+Math.round(1e6*Math.random()),self=this,$headerScroller,$headers,$secondaryHeaderScroller,$secondaryHeaders,$viewport,$canvas,$style,stylesheet,viewportH,viewportW,viewportHasHScroll,headerColumnWidthDiff,headerColumnHeightDiff,cellWidthDiff,cellHeightDiff,absoluteColumnMinWidth,currentRow,currentCell,currentCellNode=null,currentEditor=null,serializedEditorValue,editController,rowsCache={},renderedRows=0,numVisibleRows,prevScrollTop=0,scrollTop=0,lastRenderedScrollTop=0,prevScrollLeft=0,avgRowRenderTime=10,selectedRows=[],selectedRowsLookup={},columnsById={},highlightedCells,sortColumnId,sortAsc=!0,h_editorLoader=null,h_render=null,h_postrender=null,postProcessedRows={},postProcessToRow=null,postProcessFromRow=null,counter_rows_rendered=0,counter_rows_removed=0;this.debug=function(){var e="";e+="\ncounter_rows_rendered:  "+counter_rows_rendered,e+="\ncounter_rows_removed:  "+counter_rows_removed,e+="\nrenderedRows:  "+renderedRows,e+="\nnumVisibleRows:  "+numVisibleRows,e+="\nmaxSupportedCssHeight:  "+maxSupportedCssHeight,e+="\nn(umber of pages):  "+n,e+="\n(current) page:  "+page,e+="\npage height (ph):  "+ph,e+="\nscrollDir:  "+scrollDir,alert(e)},this.eval=function(expr){return eval(expr)},init(),$.extend(this,{slickGridVersion:"1.4.3",onSort:null,onHeaderContextMenu:null,onClick:null,onDblClick:null,onContextMenu:null,onKeyDown:null,onAddNewRow:null,onValidationError:null,onViewportChanged:null,onSelectedRowsChanged:null,onColumnsReordered:null,onColumnsResized:null,onBeforeMoveRows:null,onMoveRows:null,onCellChange:null,onBeforeEditCell:null,onBeforeCellEditorDestroy:null,onBeforeDestroy:null,onCurrentCellChanged:null,onCurrentCellPositionChanged:null,onCellRangeSelected:null,getColumns:getColumns,setColumns:setColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,setData:setData,destroy:destroy,getColumnIndex:getColumnIndex,autosizeColumns:autosizeColumns,updateCell:updateCell,updateRow:updateRow,removeRow:removeRow,removeRows:removeRows,removeAllRows:removeAllRows,render:render,invalidate:invalidate,setHighlightedCells:setHighlightedCells,flashCell:flashCell,getViewport:getVisibleRange,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getCurrentCell:getCurrentCell,getCurrentCellNode:getCurrentCellNode,resetCurrentCell:resetCurrentCell,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,gotoCell:gotoCell,editCurrentCell:makeSelectedCellEditable,getCellEditor:getCellEditor,scrollRowIntoView:scrollRowIntoView,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,getSecondaryHeaderRow:getSecondaryHeaderRow,showSecondaryHeaderRow:showSecondaryHeaderRow,hideSecondaryHeaderRow:hideSecondaryHeaderRow,setSortColumn:setSortColumn,getCurrentCellPosition:getCurrentCellPosition,getGridPosition:getGridPosition,getEditController:getEditController})}var scrollbarDimensions;$.extend(!0,window,{Slick:{Grid:SlickGrid,EditorLock:EditorLock,GlobalEditorLock:new EditorLock}})}(jQuery);