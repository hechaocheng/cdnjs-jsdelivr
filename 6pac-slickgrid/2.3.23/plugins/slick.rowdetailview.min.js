!function(C){C.extend(!0,window,{Slick:{Plugins:{RowDetailView:function(e){var u,c,w,a=this,t=null,d=[],i=new Slick.EventHandler,l=5,n={columnId:"_detail_selector",cssClass:"detailView-toggle",expandedClass:null,collapsedClass:null,keyPrefix:"_",loadOnce:!1,collapseAllOnSort:!0,saveDetailViewOnScroll:!0,toolTip:"",width:30,maxRows:null},p=n.keyPrefix,s=0,r=[],g=C.extend(!0,{},n,e);function f(e,i){if(e)for(var t=0;t<e.length;t++)if(e[t]===i)return t;return-1}function o(e,i){if(g.useRowClick||u.getColumns()[i.cell].id===g.columnId&&C(e.target).hasClass(g.cssClass)){if(u.getEditorLock().isActive()&&!u.getEditorLock().commitCurrentEdit())return e.preventDefault(),void e.stopImmediatePropagation();var t=_dataView.getItem(i.row);a.onBeforeRowDetailToggle.notify({grid:u,item:t},e,a),n=t,_dataView.beginUpdate(),(o=n)&&(o[p+"collapsed"]?x(o):b(o)),_dataView.endUpdate(),a.onAfterRowDetailToggle.notify({grid:u,item:t,expandedRows:d},e,a),e.stopPropagation(),e.stopImmediatePropagation()}var n,o}function m(e,i){!function(){if(u){var o=u.getRenderedRange();if(0<d.length){var a="DOWN";if(t){if(t.top===o.top&&t.bottom===o.bottom)return;(t.top>o.top||0===t.top&&0===o.top&&t.bottom>o.bottom)&&(a="UP")}}d.forEach(function(e){var i=_dataView.getRowById(e.id),t=e[p+"sizePadding"],n=0<=f(r,i);"UP"===a?(g.saveDetailViewOnScroll&&i>=o.bottom-s&&D(e),n&&i-l<o.top&&i>=o.top?v(e,i):!n&&i+t>o.bottom&&h(e,i)):"DOWN"===a&&(g.saveDetailViewOnScroll&&i<=o.top+s&&D(e),n&&i+t+l>o.bottom&&i<i+t?v(e,i):!n&&i<o.top&&h(e,i))}),t=o}}()}function h(e,i){a.onRowOutOfViewportRange.notify({grid:u,item:e,rowIndex:i,expandedRows:d,rowsOutOfViewport:R(i,!0)},null,a)}function v(e,i){var i=e.rowIndex||_dataView.getRowById(e.id);setTimeout(function(){C(".cellDetailView_"+e.id).length&&a.onRowBackToViewportRange.notify({grid:u,item:e,rowIndex:i,expandedRows:d,rowsOutOfViewport:R(i,!1)},null,a)},100)}function R(e,i){var t=f(r,e);return i&&t<0?r.push(e):!i&&0<=t&&r.splice(t,1),r}function V(){_dataView.beginUpdate();for(var e=d.length-1;0<=e;e--)b(d[e],!0);_dataView.endUpdate()}function b(i,e){e||_dataView.beginUpdate(),g.loadOnce&&D(i),i[p+"collapsed"]=!0;for(var t=1;t<=i[p+"sizePadding"];t++)_dataView.deleteItem(i.id+"."+t);i[p+"sizePadding"]=0,_dataView.updateItem(i.id,i),d=d.filter(function(e){return e.id!==i.id}),e||_dataView.endUpdate()}function x(e){if(e[p+"collapsed"]=!1,d.push(e),e[p+"detailContent"]||(e[p+"detailViewLoaded"]=!1),e[p+"detailViewLoaded"]&&!0===g.loadOnce)return a.onAsyncResponse.notify({item:e,itemDetail:e,detailView:e[p+"detailContent"]},void 0,this),_(e),void _dataView.updateItem(e.id,e);e[p+"detailContent"]=g.preTemplate(e),_(e),_dataView.updateItem(e.id,e),g.process(e)}function D(e){var i=C("."+w+" .innerDetailView_"+e.id);if(i){var t=C("."+w+" .innerDetailView_"+e.id).html();void 0!==t&&(e[p+"detailContent"]=t)}}var y=function(e,i){var t={};for(var n in u.getData())t[n]=null;return t.id=e.id+"."+i,t[p+"collapsed"]=!0,t[p+"isPadding"]=!0,t[p+"parent"]=e,t[p+"offset"]=i,t};function _(e){var i=g.panelRows;e[p+"sizePadding"]=Math.ceil(2*i*13/c.rowHeight),e[p+"height"]=e[p+"sizePadding"]*c.rowHeight;for(var t=_dataView.getIdxById(e.id),n=1;n<=e[p+"sizePadding"];n++)_dataView.insertItem(t+n,y(e,n))}function P(e,i,t,n,o){if(null==o[p+"collapsed"]&&(o[p+"collapsed"]=!0,o[p+"sizePadding"]=0,o[p+"height"]=0,o[p+"isPadding"]=!1,o[p+"parent"]=void 0,o[p+"offset"]=0),1==o[p+"isPadding"])return null;if(o[p+"collapsed"]){var a=g.cssClass+" expand ";return g.collapsedClass&&(a+=g.collapsedClass),'<div class="'+a+'"></div>'}var d=[],l=c.rowHeight,s=o[p+"sizePadding"]*c.rowHeight;null!==g.maxRows&&o[p+"sizePadding"]>g.maxRows&&(s=g.maxRows*l,o[p+"sizePadding"]=g.maxRows);var r=g.cssClass+" collapse ";return g.expandedClass&&(r+=g.expandedClass),d.push('<div class="'+r+'"></div></div>'),d.push('<div class="dynamic-cell-detail cellDetailView_',o.id,'" '),d.push('style="height:',s,"px;"),d.push("top:",l,'px">'),d.push('<div class="detail-container detailViewContainer_',o.id,'" style="min-height:'+o[p+"height"]+'px">'),d.push('<div class="innerDetailView_',o.id,'">',o[p+"detailContent"],"</div></div>"),d.join("")}C.extend(this,{init:function(e){if(!e)throw new Error('RowDetailView Plugin requires the Grid instance to be passed as argument to the "init()" method');w=(u=e).getUID(),c=e.getOptions()||{},_dataView=u.getData(),p=g&&g.keyPrefix||"_",s=u.getOptions().minRowBuffer,u.getOptions().minRowBuffer=g.panelRows+3,i.subscribe(u.onClick,o).subscribe(u.onScroll,m),g.collapseAllOnSort&&(i.subscribe(u.onSort,V),d=[],r=[]);u.getData().onRowCountChanged.subscribe(function(){u.updateRowCount(),u.render()}),u.getData().onRowsChanged.subscribe(function(e,i){u.invalidateRows(i.rows),u.render()}),a.onAsyncResponse.subscribe(function(e,i){if(!i||!i.item&&!i.itemDetail)throw'Slick.RowDetailView plugin requires the onAsyncResponse() to supply "args.item" property.';var t=i.item||i.itemDetail;i.detailView?t[p+"detailContent"]=i.detailView:t[p+"detailContent"]=g.postTemplate(t),t[p+"detailViewLoaded"]=!0,_dataView.updateItem(t.id,t),a.onAsyncEndUpdate.notify({grid:u,item:t,itemDetail:t},e,a)})},destroy:function(){i.unsubscribeAll(),a.onAsyncResponse.unsubscribe(),a.onAsyncEndUpdate.unsubscribe(),a.onAfterRowDetailToggle.unsubscribe(),a.onBeforeRowDetailToggle.unsubscribe(),a.onRowOutOfViewportRange.unsubscribe(),a.onRowBackToViewportRange.unsubscribe(),C(window).off("resize")},collapseAll:V,collapseDetailView:b,expandDetailView:x,getColumnDefinition:function(){return{id:g.columnId,name:"",toolTip:g.toolTip,field:"sel",width:g.width,resizable:!1,sortable:!1,cssClass:g.cssClass,formatter:P}},getExpandedRows:function(){return d},getFilterItem:function(e){e[p+"isPadding"]&&e[p+"parent"]&&(e=e[p+"parent"]);return e},getOptions:function(){return g},resizeDetailView:function(e){if(!e)return;var i=document.querySelector("."+w+" .detailViewContainer_"+e.id),t=document.querySelector("."+w+" .cellDetailView_"+e.id),n=document.querySelector("."+w+" .innerDetailView_"+e.id);if(!i||!t||!n)return;for(var o=1;o<=e[p+"sizePadding"];o++)_dataView.deleteItem(e.id+"."+o);var a=c.rowHeight;i.style.minHeight=null;var d=i.scrollHeight,l=Math.ceil(d/a);e[p+"sizePadding"]=Math.ceil(2*l*13/a),e[p+"height"]=d;var s=e[p+"sizePadding"]*a;null!==g.maxRows&&e[p+"sizePadding"]>g.maxRows&&(s=g.maxRows*a,e[p+"sizePadding"]=g.maxRows);u.getOptions().minRowBuffer<e[p+"sizePadding"]&&(u.getOptions().minRowBuffer=e[p+"sizePadding"]+3);i.setAttribute("style","min-height: "+e[p+"height"]+"px"),t&&t.setAttribute("style","height: "+s+"px; top:"+a+"px");for(var r=_dataView.getIdxById(e.id),o=1;o<=e[p+"sizePadding"];o++)_dataView.insertItem(r+o,y(e,o));D(e)},saveDetailView:D,setOptions:function(e){g=C.extend(!0,{},g,e)},onAsyncResponse:new Slick.Event,onAsyncEndUpdate:new Slick.Event,onAfterRowDetailToggle:new Slick.Event,onBeforeRowDetailToggle:new Slick.Event,onRowOutOfViewportRange:new Slick.Event,onRowBackToViewportRange:new Slick.Event})}}}})}(jQuery);