!function(e){function t(t){function o(e){(d=e).onKeyDown.subscribe(s);var t=e.getSelectionModel();if(!t)throw new Error("Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())");t.onSelectedRangesChanged.subscribe(function(e,t){d.focus()})}function l(){d.onKeyDown.unsubscribe(s)}function n(t,o){if(C.dataItemColumnValueExtractor){var l=C.dataItemColumnValueExtractor(t,o);if(l)return l}var n="";if(o.editor){var a={container:e("<p>"),column:o,position:{top:0,left:0},grid:d},r=new o.editor(a);r.loadValue(t),n=r.serializeValue(),r.destroy()}else n=t[o.field];return n}function a(t,o,l){if(C.dataItemColumnValueSetter)return C.dataItemColumnValueSetter(t,o,l);if(o.editor){var n={container:e("body"),column:o,position:{top:0,left:0},grid:d},a=new o.editor(n);a.loadValue(t),a.applyValue(t,l),a.destroy()}}function r(e){var t=document.createElement("textarea");return t.style.position="absolute",t.style.left="-1000px",t.style.top=document.body.scrollTop+"px",t.value=e,y.appendChild(t),t.select(),t}function i(e,t){var o=e.getColumns(),l=t.value.split(/[\n\f\r]/);""==l[l.length-1]&&l.pop();var n=[],r=0;y.removeChild(t);for(var i=0;i<l.length;i++)""!=l[i]?n[r++]=l[i].split("\t"):n[i]=[""];var s=e.getActiveCell(),u=e.getSelectionModel().getSelectedRanges(),d=u&&u.length?u[0]:null,f=null,m=null;if(d)f=d.fromRow,m=d.fromCell;else{if(!s)return;f=s.row,m=s.cell}var g=!1,p=n.length,v=n.length?n[0].length:0;1==n.length&&1==n[0].length&&d&&(g=!0,p=d.toRow-d.fromRow+1,v=d.toCell-d.fromCell+1);var w=e.getData().length-f,S=0;if(w<p){var D=e.getData();for(S=1;S<=p-w;S++)D.push({});e.setData(D),e.render()}var R=f+p>e.getDataLength();if(C.newRowCreator&&R){var x=f+p-e.getDataLength();C.newRowCreator(x)}var E={isClipboardCommand:!0,clippedRange:n,oldValues:[],cellExternalCopyManager:h,_options:C,setDataItemValueForColumn:a,markCopySelection:c,oneCellToMultiple:g,activeRow:f,activeCell:m,destH:p,destW:v,maxDestY:e.getDataLength(),maxDestX:e.getColumns().length,h:0,w:0,execute:function(){this.h=0;for(var t=0;t<this.destH;t++){this.oldValues[t]=[],this.w=0,this.h++;for(var l=0;l<this.destW;l++){this.w++;var a=f+t,r=m+l;if(a<this.maxDestY&&r<this.maxDestX){e.getCellNode(a,r);var i=e.getDataItem(a);this.oldValues[t][l]=i[o[r].field],g?this.setDataItemValueForColumn(i,o[r],n[0][0]):this.setDataItemValueForColumn(i,o[r],n[t]?n[t][l]:""),e.updateCell(a,r),e.onCellChange.notify({row:a,cell:r,item:i,grid:e})}}}var s={fromCell:m,fromRow:f,toCell:m+this.w-1,toRow:f+this.h-1};this.markCopySelection([s]),e.getSelectionModel().setSelectedRanges([s]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[s]})},undo:function(){for(var t=0;t<this.destH;t++)for(var l=0;l<this.destW;l++){var n=f+t,a=m+l;if(n<this.maxDestY&&a<this.maxDestX){e.getCellNode(n,a);var r=e.getDataItem(n);g?this.setDataItemValueForColumn(r,o[a],this.oldValues[0][0]):this.setDataItemValueForColumn(r,o[a],this.oldValues[t][l]),e.updateCell(n,a),e.onCellChange.notify({row:n,cell:a,item:r,grid:e})}}var i={fromCell:m,fromRow:f,toCell:m+this.w-1,toRow:f+this.h-1};if(this.markCopySelection([i]),e.getSelectionModel().setSelectedRanges([i]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[i]}),S>1){for(var s=e.getData();S>1;S--)s.splice(s.length-1,1);e.setData(s),e.render()}}};C.clipboardCommandHandler?C.clipboardCommandHandler(E):E.execute()}function s(e,t){var o;if(!d.getEditorLock().isActive()||d.getOptions().autoEdit){if(e.which==S.ESC&&f&&(e.preventDefault(),u(),h.onCopyCancelled.notify({ranges:f}),f=null),(e.which===S.C||e.which===S.INSERT)&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&(v&&v.call(),0!=(o=d.getSelectionModel().getSelectedRanges()).length)){f=o,c(o),h.onCopyCells.notify({ranges:o});for(var l=d.getColumns(),a="",s=0;s<o.length;s++){for(var m=o[s],g=[],p=m.fromRow;p<m.toRow+1;p++){var D=[],R=d.getDataItem(p);if(""==g&&C.includeHeaderWhenCopying){for(var x=[],E=m.fromCell;E<m.toCell+1;E++)l[E].name.length>0&&x.push(l[E].name);g.push(x.join("\t"))}for(E=m.fromCell;E<m.toCell+1;E++)D.push(n(R,l[E]));g.push(D.join("\t"))}a+=g.join("\r\n")+"\r\n"}if(window.clipboardData)return window.clipboardData.setData("Text",a),!0;var V=document.activeElement;if((I=r(a)).focus(),setTimeout(function(){y.removeChild(I),V?V.focus():console.log("Not element to restore focus to after copy?")},100),w){var b=0;b=1===o.length?o[0].toRow+1-o[0].fromRow:o.length,w.call(this,b)}return!1}if(!C.readOnlyMode&&(e.which===S.V&&(e.ctrlKey||e.metaKey)&&!e.shiftKey||e.which===S.INSERT&&e.shiftKey&&!e.ctrlKey)){var I=r("");return setTimeout(function(){i(d,I)},100),!1}}}function c(e){u();for(var t=d.getColumns(),o={},l=0;l<e.length;l++)for(var n=e[l].fromRow;n<=e[l].toRow;n++){o[n]={};for(var a=e[l].fromCell;a<=e[l].toCell&&a<t.length;a++)o[n][t[a].id]=g}d.setCellCssStyles(m,o),clearTimeout(p),p=setTimeout(function(){h.clearCopySelection()},2e3)}function u(){d.removeCellCssStyles(m)}var d,f,h=this,C=t||{},m=C.copiedCellStyleLayerKey||"copy-manager",g=C.copiedCellStyle||"copied",p=0,y=C.bodyElement||document.body,v=C.onCopyInit||null,w=C.onCopySuccess||null,S={C:67,V:86,ESC:27,INSERT:45};e.extend(this,{init:o,destroy:l,clearCopySelection:u,handleKeyDown:s,onCopyCells:new Slick.Event,onCopyCancelled:new Slick.Event,onPasteCells:new Slick.Event})}e.extend(!0,window,{Slick:{CellExternalCopyManager:t}})}(jQuery);