!function(t,r){"object"==typeof exports?module.exports=r(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],r):t.URI=r(t.punycode,t.IPv6,t.SecondLevelDomains)}(this,function(o,r,u){"use strict";function l(t,r){return this instanceof l?(void 0===t&&(t="undefined"!=typeof location?location.href+"":""),this.href(t),void 0!==r?this.absoluteTo(r):this):new l(t,r)}var t=l.prototype,d=Object.prototype.hasOwnProperty;function c(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function f(t){return"[object Array]"===String(Object.prototype.toString.call(t))}function e(t){return encodeURIComponent(t).replace(/[!'()*]/g,escape).replace(/\*/g,"%2A")}l._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:l.duplicateQueryParameters}},l.duplicateQueryParameters=!1,l.protocol_expression=/^[a-z][a-z0-9-+-]*$/i,l.idn_expression=/[^a-z0-9\.-]/i,l.punycode_expression=/(xn--)/i,l.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,l.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,l.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,l.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},l.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,l.encode=e,l.decode=decodeURIComponent,l.iso8859=function(){l.encode=escape,l.decode=unescape},l.unicode=function(){l.encode=e,l.decode=decodeURIComponent},l.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},l.encodeQuery=function(t){return l.encode(t+"").replace(/%20/g,"+")},l.decodeQuery=function(t){return l.decode((t+"").replace(/\+/g,"%20"))},l.recodePath=function(t){for(var r=(t+"").split("/"),e=0,s=r.length;e<s;e++)r[e]=l.encodePathSegment(l.decode(r[e]));return r.join("/")},l.decodePath=function(t){for(var r=(t+"").split("/"),e=0,s=r.length;e<s;e++)r[e]=l.decodePathSegment(r[e]);return r.join("/")};var s,n={encode:"encode",decode:"decode"},i=function(r,e){return function(t){return l[e](t+"").replace(l.characters[r][e].expression,function(t){return l.characters[r][e].map[t]})}};for(s in n)l[s+"PathSegment"]=i("pathname",n[s]);for(s in l.encodeReserved=i("reserved","encode"),l.parse=function(t,r){var e;return r=r||{},-1<(e=t.indexOf("#"))&&(r.fragment=t.substring(e+1)||null,t=t.substring(0,e)),-1<(e=t.indexOf("?"))&&(r.query=t.substring(e+1)||null,t=t.substring(0,e)),"//"===t.substring(0,2)?(r.protocol="",t=t.substring(2),t=l.parseAuthority(t,r)):-1<(e=t.indexOf(":"))&&(r.protocol=t.substring(0,e),r.protocol&&!r.protocol.match(l.protocol_expression)?r.protocol=void 0:"file"===r.protocol?t=t.substring(e+3):"//"===t.substring(e+1,e+3)?(t=t.substring(e+3),t=l.parseAuthority(t,r)):(t=t.substring(e+1),r.urn=!0)),r.path=t,r},l.parseHost=function(t,r){var e,s,n=t.indexOf("/");return-1===n&&(n=t.length),"["===t[0]?(e=t.indexOf("]"),r.hostname=t.substring(1,e)||null,r.port=t.substring(e+2,n)||null):t.indexOf(":")!==t.lastIndexOf(":")?(r.hostname=t.substring(0,n)||null,r.port=null):(s=t.substring(0,n).split(":"),r.hostname=s[0]||null,r.port=s[1]||null),r.hostname&&"/"!==t.substring(n)[0]&&(n++,t="/"+t),t.substring(n)||"/"},l.parseAuthority=function(t,r){return t=l.parseUserinfo(t,r),l.parseHost(t,r)},l.parseUserinfo=function(t,r){var e,s=t.indexOf("@"),n=t.indexOf("/");return-1<s&&(-1===n||s<n)?(e=t.substring(0,s).split(":"),r.username=e[0]?l.decode(e[0]):null,e.shift(),r.password=e[0]?l.decode(e.join(":")):null,t=t.substring(s+1)):(r.username=null,r.password=null),t},l.parseQuery=function(t){if(!t)return{};if(!(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var r,e,s,n={},i=t.split("&"),a=i.length,o=0;o<a;o++)r=i[o].split("="),e=l.decodeQuery(r.shift()),s=r.length?l.decodeQuery(r.join("=")):null,n[e]?("string"==typeof n[e]&&(n[e]=[n[e]]),n[e].push(s)):n[e]=s;return n},l.build=function(t){var r="";return t.protocol&&(r+=t.protocol+":"),t.urn||!r&&!t.hostname||(r+="//"),r+=l.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path[0]&&"string"==typeof t.hostname&&(r+="/"),r+=t.path),"string"==typeof t.query&&t.query&&(r+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(r+="#"+t.fragment),r},l.buildHost=function(t){var r="";return t.hostname?(l.ip6_expression.test(t.hostname)?t.port?r+="["+t.hostname+"]:"+t.port:r+=t.hostname:(r+=t.hostname,t.port&&(r+=":"+t.port)),r):""},l.buildAuthority=function(t){return l.buildUserinfo(t)+l.buildHost(t)},l.buildUserinfo=function(t){var r="";return t.username&&(r+=l.encode(t.username),t.password&&(r+=":"+l.encode(t.password)),r+="@"),r},l.buildQuery=function(t,r){var e,s,n,i,a="";for(s in t)if(d.call(t,s)&&s)if(f(t[s]))for(e={},n=0,i=t[s].length;n<i;n++)void 0!==t[s][n]&&void 0===e[t[s][n]+""]&&(a+="&"+l.buildQueryParameter(s,t[s][n]),!0!==r&&(e[t[s][n]+""]=!0));else void 0!==t[s]&&(a+="&"+l.buildQueryParameter(s,t[s]));return a.substring(1)},l.buildQueryParameter=function(t,r){return l.encodeQuery(t)+(null!==r?"="+l.encodeQuery(r):"")},l.addQuery=function(t,r,e){if("object"==typeof r)for(var s in r)d.call(r,s)&&l.addQuery(t,s,r[s]);else{if("string"!=typeof r)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[r])return void(t[r]=e);"string"==typeof t[r]&&(t[r]=[t[r]]),f(e)||(e=[e]),t[r]=t[r].concat(e)}},l.removeQuery=function(t,r,e){var s,n,i;if(f(r))for(s=0,n=r.length;s<n;s++)t[r[s]]=void 0;else if("object"==typeof r)for(i in r)d.call(r,i)&&l.removeQuery(t,i,r[i]);else{if("string"!=typeof r)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");void 0===e||t[r]===e?t[r]=void 0:f(t[r])&&(t[r]=function(t,r){var e,s,n={};if(f(r))for(e=0,s=r.length;e<s;e++)n[r[e]]=!0;else n[r]=!0;for(e=0,s=t.length;e<s;e++)void 0!==n[t[e]]&&(t.splice(e,1),s--,e--);return t}(t[r],e))}},l.commonPath=function(t,r){for(var e=Math.min(t.length,r.length),s=0;s<e;s++)if(t[s]!==r[s]){s--;break}return s<1?t[0]===r[0]&&"/"===t[0]?"/":"":("/"!==t[s]&&(s=t.substring(0,s).lastIndexOf("/")),t.substring(0,s+1))},l.withinString=function(t,r){return t.replace(l.find_uri_expression,r)},l.ensureValidHostname=function(t){if(t.match(l.invalid_hostname_characters)){if(!o)throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");if(o.toASCII(t).match(l.invalid_hostname_characters))throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-]")}},t.build=function(t){return!0===t?this._deferred_build=!0:void 0!==t&&!this._deferred_build||(this._string=l.build(this._parts),this._deferred_build=!1),this},t.clone=function(){return new l(this)},t.valueOf=t.toString=function(){return this.build(!1)._string},i=function(e){return function(t,r){return void 0===t?this._parts[e]||"":(this._parts[e]=t,this.build(!r),this)}},n={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"})t[s]=i(n[s]);for(s in i=function(e,s){return function(t,r){return void 0===t?this._parts[e]||"":(null!==t&&(t+="")[0]===s&&(t=t.substring(1)),this._parts[e]=t,this.build(!r),this)}},n={query:"?",fragment:"#"})t[s]=i(s,n[s]);for(s in i=function(s,n){return function(t,r){var e=this[s](t,r);return"string"==typeof e&&e.length?n+e:e}},n={search:["?","query"],hash:["#","fragment"]})t[s]=i(n[s][1],n[s][0]);t.pathname=function(t,r){if(void 0!==t&&!0!==t)return this._parts.path=t?l.recodePath(t):"/",this.build(!r),this;var e=this._parts.path||(this._parts.urn?"":"/");return t?l.decodePath(e):e},t.path=t.pathname,t.href=function(t,r){var e;if(void 0===t)return this.toString();this._string="",this._parts=l._parts();var s=t instanceof l,n="object"==typeof t&&(t.hostname||t.path);if(!s&&n&&"[object Object]"!==Object.prototype.toString.call(t)&&(t=t.toString()),"string"==typeof t)this._parts=l.parse(t,this._parts);else{if(!s&&!n)throw new TypeError("invalid input");var i=s?t._parts:t;for(e in i)d.call(this._parts,e)&&(this._parts[e]=i[e])}return this.build(!r),this},t.is=function(t){var r=!1,e=!1,s=!1,n=!1,i=!1,a=!1,o=!1,h=!this._parts.urn;switch(this._parts.hostname&&(h=!1,e=l.ip4_expression.test(this._parts.hostname),s=l.ip6_expression.test(this._parts.hostname),i=(n=!(r=e||s))&&u&&u.has(this._parts.hostname),a=n&&l.idn_expression.test(this._parts.hostname),o=n&&l.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return h;case"absolute":return!h;case"domain":case"name":return n;case"sld":return i;case"ip":return r;case"ip4":case"ipv4":case"inet4":return e;case"ip6":case"ipv6":case"inet6":return s;case"idn":return a;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return o}return null};var a=t.protocol,h=t.port,p=t.hostname;t.protocol=function(t,r){if(void 0!==t&&t&&(t=t.replace(/:(\/\/)?$/,"")).match(/[^a-zA-z0-9\.+-]/))throw new TypeError("Protocol '"+t+"' contains characters other than [A-Z0-9.+-]");return a.call(this,t,r)},t.scheme=t.protocol,t.port=function(t,r){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t&&(0===t&&(t=null),t&&(":"===(t+="")[0]&&(t=t.substring(1)),t.match(/[^0-9]/))))throw new TypeError("Port '"+t+"' contains characters other than [0-9]");return h.call(this,t,r)},t.hostname=function(t,r){return this._parts.urn?void 0===t?"":this:(void 0!==t&&(l.parseHost(t,e={}),t=e.hostname),p.call(this,t,r));var e},t.host=function(t,r){return this._parts.urn?void 0===t?"":this:void 0===t?this._parts.hostname?l.buildHost(this._parts):"":(l.parseHost(t,this._parts),this.build(!r),this)},t.authority=function(t,r){return this._parts.urn?void 0===t?"":this:void 0===t?this._parts.hostname?l.buildAuthority(this._parts):"":(l.parseAuthority(t,this._parts),this.build(!r),this)},t.userinfo=function(t,r){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t)return"@"!==t[t.length-1]&&(t+="@"),l.parseUserinfo(t,this._parts),this.build(!r),this;if(!this._parts.username)return"";var e=l.buildUserinfo(this._parts);return e.substring(0,e.length-1)},t.resource=function(t,r){var e;return void 0===t?this.path()+this.search()+this.hash():(e=l.parse(t),this._parts.path=e.path,this._parts.query=e.query,this._parts.fragment=e.fragment,this.build(!r),this)},t.subdomain=function(t,r){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var e=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,e)||""}var s=this._parts.hostname.length-this.domain().length,n=this._parts.hostname.substring(0,s),i=new RegExp("^"+c(n));return t&&"."!==t[t.length-1]&&(t+="."),t&&l.ensureValidHostname(t),this._parts.hostname=this._parts.hostname.replace(i,t),this.build(!r),this},t.domain=function(t,r){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(r=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var e=this._parts.hostname.match(/\./g);if(e&&e.length<2)return this._parts.hostname;var s=this._parts.hostname.length-this.tld(r).length-1,s=this._parts.hostname.lastIndexOf(".",s-1)+1;return this._parts.hostname.substring(s)||""}if(!t)throw new TypeError("cannot set domain empty");var n;return l.ensureValidHostname(t),!this._parts.hostname||this.is("IP")?this._parts.hostname=t:(n=new RegExp(c(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(n,t)),this.build(!r),this},t.tld=function(t,r){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(r=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var e=this._parts.hostname.lastIndexOf("."),s=this._parts.hostname.substring(e+1);return!0!==r&&u&&u.list[s.toLowerCase()]?u.get(this._parts.hostname)||s:s}var n;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!u||!u.is(t))throw new TypeError("TLD '"+t+"' contains characters other than [A-Z0-9]");n=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(n,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");n=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(n,t)}return this.build(!r),this},t.directory=function(t,r){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var e=this._parts.path.length-this.filename().length-1,s=this._parts.path.substring(0,e)||(this._parts.hostname?"/":"");return t?l.decodePath(s):s}var n=this._parts.path.length-this.filename().length,i=this._parts.path.substring(0,n),a=new RegExp("^"+c(i));return this.is("relative")||"/"!==(t=t||"/")[0]&&(t="/"+t),t&&"/"!==t[t.length-1]&&(t+="/"),t=l.recodePath(t),this._parts.path=this._parts.path.replace(a,t),this.build(!r),this},t.filename=function(t,r){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path||"/"===this._parts.path)return"";var e=this._parts.path.lastIndexOf("/"),s=this._parts.path.substring(e+1);return t?l.decodePathSegment(s):s}var n=!1;"/"===t[0]&&(t=t.substring(1)),t.match(/\.?\//)&&(n=!0);var i=new RegExp(c(this.filename())+"$");return t=l.recodePath(t),this._parts.path=this._parts.path.replace(i,t),n?this.normalizePath(r):this.build(!r),this},t.suffix=function(t,r){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path||"/"===this._parts.path)return"";var e,s,n=this.filename(),i=n.lastIndexOf(".");return-1===i?"":(e=n.substring(i+1),s=/^[a-z0-9%]+$/i.test(e)?e:"",t?l.decodePathSegment(s):s)}"."===t[0]&&(t=t.substring(1));var a,o=this.suffix();if(o)a=t?new RegExp(c(o)+"$"):new RegExp(c("."+o)+"$");else{if(!t)return this;this._parts.path+="."+l.recodePath(t)}return a&&(t=l.recodePath(t),this._parts.path=this._parts.path.replace(a,t)),this.build(!r),this},t.segment=function(t,r,e){var s=this._parts.urn?":":"/",n=this.path(),i="/"===n.substring(0,1),a=n.split(s);if("number"!=typeof t&&(e=r,r=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error("Bad segment '"+t+"', must be 0-based integer");return i&&a.shift(),t<0&&(t=Math.max(a.length+t,0)),void 0===r?void 0===t?a:a[t]:(null===t||void 0===a[t]?f(r)?a=r:(r||"string"==typeof r&&r.length)&&(""===a[a.length-1]?a[a.length-1]=r:a.push(r)):r||"string"==typeof r&&r.length?a[t]=r:a.splice(t,1),i&&a.unshift(""),this.path(a.join(s),e))};var m=t.query;return t.query=function(t,r){return!0===t?l.parseQuery(this._parts.query):void 0!==t&&"string"!=typeof t?(this._parts.query=l.buildQuery(t,this._parts.duplicateQueryParameters),this.build(!r),this):m.call(this,t,r)},t.addQuery=function(t,r,e){var s=l.parseQuery(this._parts.query);return l.addQuery(s,t,void 0===r?null:r),this._parts.query=l.buildQuery(s,this._parts.duplicateQueryParameters),"string"!=typeof t&&(e=r),this.build(!e),this},t.removeQuery=function(t,r,e){var s=l.parseQuery(this._parts.query);return l.removeQuery(s,t,r),this._parts.query=l.buildQuery(s,this._parts.duplicateQueryParameters),"string"!=typeof t&&(e=r),this.build(!e),this},t.addSearch=t.addQuery,t.removeSearch=t.removeQuery,t.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},t.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},t.normalizeHostname=function(t){return this._parts.hostname&&(this.is("IDN")&&o?this._parts.hostname=o.toASCII(this._parts.hostname):this.is("IPv6")&&r&&(this._parts.hostname=r.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!t)),this},t.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===l.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},t.normalizePath=function(t){if(this._parts.urn)return this;if(!this._parts.path||"/"===this._parts.path)return this;var r,e,s,n,i=this._parts.path;for("/"!==i[0]&&("."===i[0]&&(e=i.substring(0,i.indexOf("/"))),r=!0,i="/"+i),i=i.replace(/(\/(\.\/)+)|\/{2,}/g,"/");-1!==(s=i.indexOf("/../"));){if(0===s){i=i.substring(3);break}-1===(n=i.substring(0,s).lastIndexOf("/"))&&(n=s),i=i.substring(0,n)+i.substring(s+3)}return r&&this.is("relative")&&(i=e?e+i:i.substring(1)),i=l.recodePath(i),this._parts.path=i,this.build(!t),this},t.normalizePathname=t.normalizePath,t.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(l.parseQuery(this._parts.query)):this._parts.query=null,this.build(!t)),this},t.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},t.normalizeSearch=t.normalizeQuery,t.normalizeHash=t.normalizeFragment,t.iso8859=function(){var t=l.encode,r=l.decode;return l.encode=escape,l.decode=decodeURIComponent,this.normalize(),l.encode=t,l.decode=r,this},t.unicode=function(){var t=l.encode,r=l.decode;return l.encode=e,l.decode=unescape,this.normalize(),l.encode=t,l.decode=r,this},t.readable=function(){var t=this.clone();t.username("").password("").normalize();var r="";if(t._parts.protocol&&(r+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&o?(r+=o.toUnicode(t._parts.hostname),t._parts.port&&(r+=":"+t._parts.port)):r+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path[0]&&(r+="/"),r+=t.path(!0),t._parts.query){for(var e="",s=0,n=t._parts.query.split("&"),i=n.length;s<i;s++){var a=(n[s]||"").split("=");e+="&"+l.decodeQuery(a[0]).replace(/&/g,"%26"),void 0!==a[1]&&(e+="="+l.decodeQuery(a[1]).replace(/&/g,"%26"))}r+="?"+e.substring(1)}return r+=t.hash()},t.absoluteTo=function(t){var r,e,s,n=this.clone(),i=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");if(this._parts.hostname)return n;for(t instanceof l||(t=new l(t)),e=0;s=i[e];e++)n._parts[s]=t._parts[s];for(i=["query","path"],e=0;s=i[e];e++)!n._parts[s]&&t._parts[s]&&(n._parts[s]=t._parts[s]);return"/"!==n.path()[0]&&(r=t.directory(),n._parts.path=(r?r+"/":"")+n._parts.path,n.normalizePath()),n.build(),n},t.relativeTo=function(t){var r,e,s,n,i=this.clone(),a=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");if(t instanceof l||(t=new l(t)),"/"!==this.path()[0]||"/"!==t.path()[0])throw new Error("Cannot calculate common path from non-relative URLs");if(!(r=l.commonPath(i.path(),t.path()))||"/"===r)return i;for(var o,h=0;o=a[h];h++)i._parts[o]=null;if((e=t.directory())===(s=this.directory()))return i._parts.path="./"+i.filename(),i.build();if(e.substring(r.length),n=s.substring(r.length),e+"/"===r)return n&&(n+="/"),i._parts.path="./"+n+i.filename(),i.build();for(var u="../",p=new RegExp("^"+c(r)),d=e.replace(p,"/").match(/\//g).length-1;d--;)u+="../";return i._parts.path=i._parts.path.replace(p,u),i.build()},t.equals=function(t){var r,e,s,n=this.clone(),i=new l(t),a={},o={},h={};if(n.normalize(),i.normalize(),n.toString()===i.toString())return!0;if(r=n.query(),e=i.query(),n.query(""),i.query(""),n.toString()!==i.toString())return!1;if(r.length!==e.length)return!1;for(s in a=l.parseQuery(r),o=l.parseQuery(e),a)if(d.call(a,s)){if(f(a[s])){if(!f(o[s]))return!1;if(a[s].length!==o[s].length)return!1;a[s].sort(),o[s].sort();for(var u=0,p=a[s].length;u<p;u++)if(a[s][u]!==o[s][u])return!1}else if(a[s]!==o[s])return!1;h[s]=!0}for(s in o)if(d.call(o,s)&&!h[s])return!1;return!0},t.duplicateQueryParameters=function(t){return this._parts.duplicateQueryParameters=!!t,this},l});