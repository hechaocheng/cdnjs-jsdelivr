"use strict";var __decorate=this&&this.__decorate||function(e,t,o,n){var r,p=arguments.length,i=p<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(i=(p<3?r(i):3<p?r(t,o,i):r(t,o))||i);return 3<p&&i&&Object.defineProperty(t,o,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var ComponentType,ComponentSource,context_1=require("../../context/context"),gridOptionsWrapper_1=require("../../gridOptionsWrapper"),componentProvider_1=require("./componentProvider"),agComponentUtils_1=require("./agComponentUtils"),componentMetadataProvider_1=require("./componentMetadataProvider"),utils_1=require("../../utils");!function(e){e[e.AG_GRID=0]="AG_GRID",e[e.FRAMEWORK=1]="FRAMEWORK"}(ComponentType=exports.ComponentType||(exports.ComponentType={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.REGISTERED_BY_NAME=1]="REGISTERED_BY_NAME",e[e.HARDCODED=2]="HARDCODED"}(ComponentSource=exports.ComponentSource||(exports.ComponentSource={}));var ComponentResolver=function(){function e(){}return e.prototype.getComponentToUse=function(e,t,o,n){var r,p,i,a=null,m=null,c=null,s=null;if(null!=e&&(null==(p=e[t])||!0===p||("string"==typeof p?a=p:"boolean"==typeof p||(this.agComponentUtils.doesImplementIComponent(p)?m=p:c=p)),s=e[t+"Framework"],r=e[t+"Selector"]),m&&s||a&&s||c&&s)throw Error("ag-grid: you are trying to specify: "+t+" twice as a component.");if(s&&!this.frameworkComponentWrapper)throw Error("ag-grid: you are specifying a framework component but you are not using a framework version of ag-grid for : "+t);if(r&&(a||m||c||s))throw Error("ag-grid: you can't specify both, the selector and the component of ag-grid for : "+t);if(s)return{type:ComponentType.FRAMEWORK,component:s,source:ComponentSource.HARDCODED,dynamicParams:null};if(m)return{type:ComponentType.AG_GRID,component:m,source:ComponentSource.HARDCODED,dynamicParams:null};if(c)return this.agComponentUtils.adaptFunction(t,c,ComponentType.AG_GRID,ComponentSource.HARDCODED);if(r){var u=r(o);if(null!=u){null==u.component&&(u.component=n);var d=this.resolveByName(t,u.component);return utils_1._.assign(d,{dynamicParams:u.params})}}return null==(i=a||n)?null:this.resolveByName(t,i)},e.prototype.resolveByName=function(e,t){var o=null!=t?t:e,n=this.componentProvider.retrieve(o);return null==n?null:n.type==ComponentType.FRAMEWORK?{component:n.component,type:ComponentType.FRAMEWORK,source:ComponentSource.REGISTERED_BY_NAME,dynamicParams:null}:this.agComponentUtils.doesImplementIComponent(n.component)?{component:n.component,type:ComponentType.AG_GRID,source:n.source==componentProvider_1.RegisteredComponentSource.REGISTERED?ComponentSource.REGISTERED_BY_NAME:ComponentSource.DEFAULT,dynamicParams:null}:this.agComponentUtils.adaptFunction(e,n.component,n.type,n.source==componentProvider_1.RegisteredComponentSource.REGISTERED?ComponentSource.REGISTERED_BY_NAME:ComponentSource.DEFAULT)},e.prototype.mergeParams=function(e,t,o,n,r){void 0===r&&(r=null);var p,i=e?e[t+"Params"]:null,a={};return utils_1._.mergeDeep(a,o),null!=i&&(p=utils_1._.cloneObject(a),p="function"==typeof i?(utils_1._.mergeDeep(p,n),i(p)):i,utils_1._.mergeDeep(a,p)),utils_1._.mergeDeep(a,r),a.api||(a.api=this.gridOptions.api),a},e.prototype.createAgGridComponent=function(e,t,o,n,r,p,i){void 0===p&&(p=!0);var a=e||this.gridOptions,m=this.newAgGridComponent(a,o,n,r,p);if(!m)return null;var c=this.mergeParams(a,o,t,n,m[1]);c.agGridReact=this.context.getBean("agGridReact")?utils_1._.cloneObject(this.context.getBean("agGridReact")):{},c.frameworkComponentWrapper=this.context.getBean("frameworkComponentWrapper")?this.context.getBean("frameworkComponentWrapper"):{};var s=this.initialiseComponent(m[0],c,i);return null==s?utils_1.Promise.resolve(m[0]):s.map(function(e){return m[0]})},e.prototype.createInternalAgGridComponent=function(e,t,o){var n=new e;return this.initialiseComponent(n,t,o),n},e.prototype.newAgGridComponent=function(e,t,o,n,r){void 0===r&&(r=!0);var p=this.getComponentToUse(e,t,o,n);if(!p||!p.component)return r&&console.error("Error creating component "+t+"=>"+n),null;if(p.type===ComponentType.AG_GRID)return[new p.component,p.dynamicParams];var i=p.component,a=this.componentMetadataProvider.retrieve(t);return[this.frameworkComponentWrapper.wrap(i,a.mandatoryMethodList,a.optionalMethodList,n),p.dynamicParams]},e.prototype.initialiseComponent=function(e,t,o){if(this.context.wireBean(e),null!=e.init)return null==o?e.init(t):e.init(o(t,e))},__decorate([context_1.Autowired("gridOptions"),__metadata("design:type",Object)],e.prototype,"gridOptions",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("context"),__metadata("design:type",context_1.Context)],e.prototype,"context",void 0),__decorate([context_1.Autowired("agComponentUtils"),__metadata("design:type",agComponentUtils_1.AgComponentUtils)],e.prototype,"agComponentUtils",void 0),__decorate([context_1.Autowired("componentMetadataProvider"),__metadata("design:type",componentMetadataProvider_1.ComponentMetadataProvider)],e.prototype,"componentMetadataProvider",void 0),__decorate([context_1.Autowired("componentProvider"),__metadata("design:type",componentProvider_1.ComponentProvider)],e.prototype,"componentProvider",void 0),__decorate([context_1.Optional("frameworkComponentWrapper"),__metadata("design:type",Object)],e.prototype,"frameworkComponentWrapper",void 0),e=__decorate([context_1.Bean("componentResolver")],e)}();exports.ComponentResolver=ComponentResolver;