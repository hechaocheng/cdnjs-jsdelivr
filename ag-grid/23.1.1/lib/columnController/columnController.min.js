"use strict";var __decorate=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var u=t.length-1;0<=u;u--)(n=t[u])&&(r=(s<3?n(r):3<s?n(e,i,r):n(e,i))||r);return 3<s&&r&&Object.defineProperty(e,i,r),r},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__param=this&&this.__param||function(i,o){return function(t,e){o(t,e,i)}};Object.defineProperty(exports,"__esModule",{value:!0});var columnGroup_1=require("../entities/columnGroup"),column_1=require("../entities/column"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),expressionService_1=require("../valueService/expressionService"),columnFactory_1=require("./columnFactory"),displayedGroupCreator_1=require("./displayedGroupCreator"),autoWidthCalculator_1=require("../rendering/autoWidthCalculator"),eventService_1=require("../eventService"),columnUtils_1=require("./columnUtils"),logger_1=require("../logger"),events_1=require("../events"),originalColumnGroup_1=require("../entities/originalColumnGroup"),groupInstanceIdCreator_1=require("./groupInstanceIdCreator"),context_1=require("../context/context"),columnAnimationService_1=require("../rendering/columnAnimationService"),autoGroupColService_1=require("./autoGroupColService"),valueCache_1=require("../valueService/valueCache"),gridApi_1=require("../gridApi"),columnApi_1=require("./columnApi"),utils_1=require("../utils"),ColumnController=function(){function t(){this.primaryHeaderRowCount=0,this.secondaryHeaderRowCount=0,this.secondaryColumnsPresent=!1,this.gridHeaderRowCount=0,this.displayedLeftColumns=[],this.displayedRightColumns=[],this.displayedCenterColumns=[],this.allDisplayedColumns=[],this.allDisplayedVirtualColumns=[],this.allDisplayedCenterVirtualColumns=[],this.rowGroupColumns=[],this.valueColumns=[],this.pivotColumns=[],this.ready=!1,this.autoGroupsNeedBuilding=!1,this.pivotMode=!1,this.bodyWidth=0,this.leftWidth=0,this.rightWidth=0,this.bodyWidthDirty=!0}return t.prototype.init=function(){var t=this.gridOptionsWrapper.isPivotMode();this.suppressColumnVirtualisation=this.gridOptionsWrapper.isSuppressColumnVirtualisation(),this.isPivotSettingAllowed(t)&&(this.pivotMode=t),this.usingTreeData=this.gridOptionsWrapper.isTreeData()},t.prototype.setColumnDefs=function(t,e){void 0===e&&(e="api");var i=!!this.columnDefs;this.columnDefs=t,this.valueCache.expire(),this.autoGroupsNeedBuilding=!0;var o=this.primaryColumns,n=this.columnFactory.createColumnTree(t,!0,o);this.primaryColumnTree=n.columnTree,this.primaryHeaderRowCount=n.treeDept+1,this.primaryColumns=this.getColumnsFromTree(this.primaryColumnTree),this.extractRowGroupColumns(e,o),this.extractPivotColumns(e,o),this.createValueColumns(e,o),this.ready=!0,this.updateGridColumns(),this.updateDisplayedColumns(e),this.checkDisplayedVirtualColumns(),this.gridOptionsWrapper.isDeltaColumnMode()&&i&&this.resetColumnState(!0,e);var s={type:events_1.Events.EVENT_COLUMN_EVERYTHING_CHANGED,api:this.gridApi,columnApi:this.columnApi,source:e};this.eventService.dispatchEvent(s);var r={type:events_1.Events.EVENT_NEW_COLUMNS_LOADED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(r)},t.prototype.isAutoRowHeightActive=function(){return this.autoRowHeightColumns&&0<this.autoRowHeightColumns.length},t.prototype.getAllAutoRowHeightCols=function(){return this.autoRowHeightColumns},t.prototype.setVirtualViewportLeftAndRight=function(){this.gridOptionsWrapper.isEnableRtl()?(this.viewportLeft=this.bodyWidth-this.scrollPosition-this.scrollWidth,this.viewportRight=this.bodyWidth-this.scrollPosition):(this.viewportLeft=this.scrollPosition,this.viewportRight=this.scrollWidth+this.scrollPosition)},t.prototype.getDisplayedColumnsStartingAt=function(t){for(var e=t,i=[];e&&utils_1._.exists(e);)i.push(e),e=this.getDisplayedColAfter(e);return i},t.prototype.checkDisplayedVirtualColumns=function(){var t,e;utils_1._.exists(this.displayedCenterColumns)&&(t=this.allDisplayedVirtualColumns.map(function(t){return t.getId()}).join("#"),this.updateVirtualSets(),t!==this.allDisplayedVirtualColumns.map(function(t){return t.getId()}).join("#")&&(e={type:events_1.Events.EVENT_VIRTUAL_COLUMNS_CHANGED,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEvent(e)))},t.prototype.setVirtualViewportPosition=function(t,e){t===this.scrollWidth&&e===this.scrollPosition&&!this.bodyWidthDirty||(this.scrollWidth=t,this.scrollPosition=e,this.bodyWidthDirty=!0,this.setVirtualViewportLeftAndRight(),this.ready&&this.checkDisplayedVirtualColumns())},t.prototype.isPivotMode=function(){return this.pivotMode},t.prototype.isPivotSettingAllowed=function(t){return!t||(!this.gridOptionsWrapper.isTreeData()||(console.warn("ag-Grid: Pivot mode not available in conjunction Tree Data i.e. 'gridOptions.treeData: true'"),!1))},t.prototype.setPivotMode=function(t,e){var i;void 0===e&&(e="api"),t!==this.pivotMode&&this.isPivotSettingAllowed(this.pivotMode)&&(this.pivotMode=t,this.autoGroupsNeedBuilding=!0,this.updateGridColumns(),this.updateDisplayedColumns(e),i={type:events_1.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEvent(i))},t.prototype.getSecondaryPivotColumn=function(o,t){if(!this.secondaryColumnsPresent)return null;var n=this.getPrimaryColumn(t),s=null;return this.secondaryColumns&&this.secondaryColumns.forEach(function(t){var e=t.getColDef().pivotKeys,i=t.getColDef().pivotValueColumn;utils_1._.compareArrays(e,o)&&i===n&&(s=t)}),s},t.prototype.setBeans=function(t){this.logger=t.create("ColumnController")},t.prototype.setFirstRightAndLastLeftPinned=function(e){var i,o=this.gridOptionsWrapper.isEnableRtl()?(i=this.displayedLeftColumns?this.displayedLeftColumns[0]:null,this.displayedRightColumns?utils_1._.last(this.displayedRightColumns):null):(i=this.displayedLeftColumns?utils_1._.last(this.displayedLeftColumns):null,this.displayedRightColumns?this.displayedRightColumns[0]:null);this.gridColumns.forEach(function(t){t.setLastLeftPinned(t===i,e),t.setFirstRightPinned(t===o,e)})},t.prototype.autoSizeColumns=function(t,o){var n=this;void 0===o&&(o="api");for(var e,s=[],r=-1;0!==r;)r=0,this.actionOnGridColumns(t,function(t){if(0<=s.indexOf(t))return!1;var e,i=n.autoWidthCalculator.getPreferredWidthForColumn(t);return 0<i&&(e=n.normaliseColumnWidth(t,i),t.setActualWidth(e,o),s.push(t),r++),!0},o);0<s.length&&(e={type:events_1.Events.EVENT_COLUMN_RESIZED,columns:s,column:1===s.length?s[0]:null,finished:!0,api:this.gridApi,columnApi:this.columnApi,source:"autosizeColumns"},this.eventService.dispatchEvent(e))},t.prototype.autoSizeColumn=function(t,e){void 0===e&&(e="api"),t&&this.autoSizeColumns([t],e)},t.prototype.autoSizeAllColumns=function(t){void 0===t&&(t="api");var e=this.getAllDisplayedColumns();this.autoSizeColumns(e,t)},t.prototype.getColumnsFromTree=function(t){var n=[];return function t(e){for(var i=0;i<e.length;i++){var o=e[i];o instanceof column_1.Column?n.push(o):o instanceof originalColumnGroup_1.OriginalColumnGroup&&t(o.getChildren())}}(t),n},t.prototype.getAllDisplayedColumnGroups=function(){return this.displayedLeftColumnTree&&this.displayedRightColumnTree&&this.displayedCentreColumnTree?this.displayedLeftColumnTree.concat(this.displayedCentreColumnTree).concat(this.displayedRightColumnTree):null},t.prototype.getPrimaryColumnTree=function(){return this.primaryColumnTree},t.prototype.getHeaderRowCount=function(){return this.gridHeaderRowCount},t.prototype.getLeftDisplayedColumnGroups=function(){return this.displayedLeftColumnTree},t.prototype.getRightDisplayedColumnGroups=function(){return this.displayedRightColumnTree},t.prototype.getCenterDisplayedColumnGroups=function(){return this.displayedCentreColumnTree},t.prototype.getDisplayedColumnGroups=function(t){switch(t){case column_1.Column.PINNED_LEFT:return this.getLeftDisplayedColumnGroups();case column_1.Column.PINNED_RIGHT:return this.getRightDisplayedColumnGroups();default:return this.getCenterDisplayedColumnGroups()}},t.prototype.isColumnDisplayed=function(t){return 0<=this.getAllDisplayedColumns().indexOf(t)},t.prototype.getAllDisplayedColumns=function(){return this.allDisplayedColumns},t.prototype.getAllDisplayedVirtualColumns=function(){return this.allDisplayedVirtualColumns},t.prototype.getDisplayedLeftColumnsForRow=function(t){return this.colSpanActive?this.getDisplayedColumnsForRow(t,this.displayedLeftColumns):this.displayedLeftColumns},t.prototype.getDisplayedRightColumnsForRow=function(t){return this.colSpanActive?this.getDisplayedColumnsForRow(t,this.displayedRightColumns):this.displayedRightColumns},t.prototype.getDisplayedColumnsForRow=function(l,a,p,d){for(var h,c=[],m=null,t=function(t){var e,i=a[t],o=a.length-t,n=Math.min(i.getColSpan(l),o),s=[i];if(1<n){for(var r=n-1,u=1;u<=r;u++)s.push(a[t+u]);t+=r}p?(e=!1,s.forEach(function(t){p(t)&&(e=!0)})):e=!0,e&&(0===c.length&&m&&!!d&&d(i)&&c.push(m),c.push(i)),m=i,h=t},e=0;e<a.length;e++)t(e),e=h;return c},t.prototype.getAllDisplayedCenterVirtualColumnsForRow=function(t){var e=this;if(!this.colSpanActive)return this.allDisplayedCenterVirtualColumns;var i=this.suppressColumnVirtualisation?null:this.isColumnInViewport.bind(this);return this.getDisplayedColumnsForRow(t,this.displayedCenterColumns,i,function(t){return t.getLeft()>e.viewportLeft})},t.prototype.isColumnInViewport=function(t){var e=t.getLeft(),i=t.getLeft()+t.getActualWidth(),o=this.viewportLeft-200,n=this.viewportRight+200;return!(e<o&&i<o)&&!(n<e&&n<i)},t.prototype.getPinnedLeftContainerWidth=function(){return this.getWidthOfColsInList(this.displayedLeftColumns)},t.prototype.getPinnedRightContainerWidth=function(){return this.getWidthOfColsInList(this.displayedRightColumns)},t.prototype.updatePrimaryColumnList=function(t,i,o,n,e,s){var r,u,l=this;void 0===s&&(s="api"),t&&!utils_1._.missingOrEmpty(t)&&(r=!1,t.forEach(function(t){var e=l.getPrimaryColumn(t);if(e){if(o){if(0<=i.indexOf(e))return;i.push(e)}else{if(i.indexOf(e)<0)return;utils_1._.removeFromArray(i,e)}n(e),r=!0}}),r&&(this.autoGroupsNeedBuilding&&this.updateGridColumns(),this.updateDisplayedColumns(s),u={type:e,columns:i,column:1===i.length?i[0]:null,api:this.gridApi,columnApi:this.columnApi,source:s},this.eventService.dispatchEvent(u)))},t.prototype.setRowGroupColumns=function(t,e){void 0===e&&(e="api"),this.autoGroupsNeedBuilding=!0,this.setPrimaryColumnList(t,this.rowGroupColumns,events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.setRowGroupActive.bind(this),e)},t.prototype.setRowGroupActive=function(t,e,i){t!==e.isRowGroupActive()&&(e.setRowGroupActive(t,i),t||this.gridOptionsWrapper.isSuppressMakeColumnVisibleAfterUnGroup()||e.setVisible(!0,i))},t.prototype.addRowGroupColumn=function(t,e){void 0===e&&(e="api"),t&&this.addRowGroupColumns([t],e)},t.prototype.addRowGroupColumns=function(t,e){void 0===e&&(e="api"),this.autoGroupsNeedBuilding=!0,this.updatePrimaryColumnList(t,this.rowGroupColumns,!0,this.setRowGroupActive.bind(this,!0),events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e)},t.prototype.removeRowGroupColumns=function(t,e){void 0===e&&(e="api"),this.autoGroupsNeedBuilding=!0,this.updatePrimaryColumnList(t,this.rowGroupColumns,!1,this.setRowGroupActive.bind(this,!1),events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e)},t.prototype.removeRowGroupColumn=function(t,e){void 0===e&&(e="api"),t&&this.removeRowGroupColumns([t],e)},t.prototype.addPivotColumns=function(t,e){void 0===e&&(e="api"),this.updatePrimaryColumnList(t,this.pivotColumns,!0,function(t){return t.setPivotActive(!0,e)},events_1.Events.EVENT_COLUMN_PIVOT_CHANGED,e)},t.prototype.setPivotColumns=function(t,i){void 0===i&&(i="api"),this.setPrimaryColumnList(t,this.pivotColumns,events_1.Events.EVENT_COLUMN_PIVOT_CHANGED,function(t,e){e.setPivotActive(t,i)},i)},t.prototype.addPivotColumn=function(t,e){void 0===e&&(e="api"),this.addPivotColumns([t],e)},t.prototype.removePivotColumns=function(t,e){void 0===e&&(e="api"),this.updatePrimaryColumnList(t,this.pivotColumns,!1,function(t){return t.setPivotActive(!1,e)},events_1.Events.EVENT_COLUMN_PIVOT_CHANGED,e)},t.prototype.removePivotColumn=function(t,e){void 0===e&&(e="api"),this.removePivotColumns([t],e)},t.prototype.setPrimaryColumnList=function(t,i,e,o,n){var s=this;i.length=0,utils_1._.exists(t)&&t.forEach(function(t){var e=s.getPrimaryColumn(t);e&&i.push(e)}),this.primaryColumns.forEach(function(t){var e=0<=i.indexOf(t);o(e,t)}),this.autoGroupsNeedBuilding&&this.updateGridColumns(),this.updateDisplayedColumns(n);var r={type:e,columns:i,column:1===i.length?i[0]:null,api:this.gridApi,columnApi:this.columnApi,source:n};this.eventService.dispatchEvent(r)},t.prototype.setValueColumns=function(t,e){void 0===e&&(e="api"),this.setPrimaryColumnList(t,this.valueColumns,events_1.Events.EVENT_COLUMN_VALUE_CHANGED,this.setValueActive.bind(this),e)},t.prototype.setValueActive=function(t,e,i){var o;t!==e.isValueActive()&&(e.setValueActive(t,i),t&&!e.getAggFunc()&&(o=this.aggFuncService.getDefaultAggFunc(e),e.setAggFunc(o)))},t.prototype.addValueColumns=function(t,e){void 0===e&&(e="api"),this.updatePrimaryColumnList(t,this.valueColumns,!0,this.setValueActive.bind(this,!0),events_1.Events.EVENT_COLUMN_VALUE_CHANGED,e)},t.prototype.addValueColumn=function(t,e){void 0===e&&(e="api"),t&&this.addValueColumns([t],e)},t.prototype.removeValueColumn=function(t,e){void 0===e&&(e="api"),this.removeValueColumns([t],e)},t.prototype.removeValueColumns=function(t,e){void 0===e&&(e="api"),this.updatePrimaryColumnList(t,this.valueColumns,!1,this.setValueActive.bind(this,!1),events_1.Events.EVENT_COLUMN_VALUE_CHANGED,e)},t.prototype.normaliseColumnWidth=function(t,e){return e<t.getMinWidth()&&(e=t.getMinWidth()),t.isGreaterThanMax(e)&&(e=t.getMaxWidth()),e},t.prototype.getPrimaryOrGridColumn=function(t){var e=this.getPrimaryColumn(t);return e||this.getGridColumn(t)},t.prototype.setColumnWidth=function(t,e,i,o,n){void 0===n&&(n="api");var s=this.getPrimaryOrGridColumn(t);if(s){var r=[];if(r.push({width:e,ratios:[1],columns:[s]}),"shift"===this.gridOptionsWrapper.getColResizeDefault()&&(i=!i),i){var u=this.getDisplayedColAfter(s);if(!u)return;var l=s.getActualWidth()-e,a=u.getActualWidth()+l;r.push({width:a,ratios:[1],columns:[u]})}this.resizeColumnSets(r,o,n)}},t.prototype.checkMinAndMaxWidthsForSet=function(t){var e=t.columns,i=t.width,o=0,n=0,s=!0;return e.forEach(function(t){o+=t.getMinWidth(),0<t.getMaxWidth()?n+=t.getMaxWidth():s=!1}),o<=i&&(!s||i<=n)},t.prototype.resizeColumnSets=function(t,e,i){var n,s,o,r,u,l;utils_1._.every(t,this.checkMinAndMaxWidthsForSet.bind(this))?(n=[],s=[],t.forEach(function(t){var l=t.width,e=t.columns,a=t.ratios,p={},d={};e.forEach(function(t){return s.push(t)});for(var h=!0,i=0,o=function(){if(1e3<++i)return console.error("ag-Grid: infinite loop in resizeColumnSets"),"break";h=!1;var o=[],n=[],s=0,r=l;e.forEach(function(t,e){var i;d[t.getId()]?r-=p[t.getId()]:(o.push(t),i=a[e],s+=i,n.push(i))});var u=1/s;o.forEach(function(t,e){var i;e===o.length-1?i=r:(i=Math.round(a[e]*l*u),r-=i),i<t.getMinWidth()?(i=t.getMinWidth(),d[t.getId()]=!0,h=!0):0<t.getMaxWidth()&&i>t.getMaxWidth()&&(i=t.getMaxWidth(),d[t.getId()]=!0,h=!0),p[t.getId()]=i})};h;){if("break"===o())break}e.forEach(function(t){var e=p[t.getId()];t.getActualWidth()!==e&&(t.setActualWidth(e),n.push(t))})}),(o=0<n.length)&&(this.setLeftValues(i),this.updateBodyWidths(),this.checkDisplayedVirtualColumns()),(o||e)&&(r={type:events_1.Events.EVENT_COLUMN_RESIZED,columns:s,column:1===s.length?s[0]:null,finished:e,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(r))):e&&(u=t&&0<t.length?t[0].columns:null,l={type:events_1.Events.EVENT_COLUMN_RESIZED,columns:u,column:u&&1===u.length?u[0]:null,finished:e,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(l))},t.prototype.setColumnAggFunc=function(t,e,i){var o;void 0===i&&(i="api"),t&&(t.setAggFunc(e),o={type:events_1.Events.EVENT_COLUMN_VALUE_CHANGED,columns:[t],column:t,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(o))},t.prototype.moveRowGroupColumn=function(t,e,i){void 0===i&&(i="api");var o=this.rowGroupColumns[t];this.rowGroupColumns.splice(t,1),this.rowGroupColumns.splice(e,0,o);var n={type:events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,columns:this.rowGroupColumns,column:1===this.rowGroupColumns.length?this.rowGroupColumns[0]:null,api:this.gridApi,columnApi:this.columnApi,source:i};this.eventService.dispatchEvent(n)},t.prototype.moveColumns=function(t,e,i){if(void 0===i&&(i="api"),this.columnAnimationService.start(),e>this.gridColumns.length-t.length)return console.warn("ag-Grid: tried to insert columns in invalid location, toIndex = "+e),void console.warn("ag-Grid: remember that you should not count the moving columns when calculating the new index");var o,n=this.getGridColumns(t);this.doesMovePassRules(n,e)&&(utils_1._.moveInArray(this.gridColumns,n,e),this.updateDisplayedColumns(i),o={type:events_1.Events.EVENT_COLUMN_MOVED,columns:n,column:1===n.length?n[0]:null,toIndex:e,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(o),this.columnAnimationService.finish())},t.prototype.doesMovePassRules=function(t,e){var i=this.gridColumns.slice();return utils_1._.moveInArray(i,t,e),!!this.doesMovePassMarryChildren(i)&&!!this.doesMovePassLockedPositions(i)},t.prototype.doesMovePassLockedPositions=function(t){var e=!1,i=!0;return t.forEach(function(t){t.getColDef().lockPosition?e&&(i=!1):e=!0}),i},t.prototype.doesMovePassMarryChildren=function(n){var s=!0;return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(t){var e,i,o;t instanceof originalColumnGroup_1.OriginalColumnGroup&&((e=t).getColGroupDef()&&e.getColGroupDef().marryChildren&&(i=[],e.getLeafColumns().forEach(function(t){var e=n.indexOf(t);i.push(e)}),o=Math.max.apply(Math,i)-Math.min.apply(Math,i),e.getLeafColumns().length-1<o&&(s=!1)))}),s},t.prototype.moveColumn=function(t,e,i){void 0===i&&(i="api"),this.moveColumns([t],e,i)},t.prototype.moveColumnByIndex=function(t,e,i){void 0===i&&(i="api");var o=this.gridColumns[t];this.moveColumn(o,e,i)},t.prototype.getBodyContainerWidth=function(){return this.bodyWidth},t.prototype.getContainerWidth=function(t){switch(t){case column_1.Column.PINNED_LEFT:return this.leftWidth;case column_1.Column.PINNED_RIGHT:return this.rightWidth;default:return this.bodyWidth}},t.prototype.updateBodyWidths=function(){var t,e=this.getWidthOfColsInList(this.displayedCenterColumns),i=this.getWidthOfColsInList(this.displayedLeftColumns),o=this.getWidthOfColsInList(this.displayedRightColumns);this.bodyWidthDirty=this.bodyWidth!==e,this.bodyWidth===e&&this.leftWidth===i&&this.rightWidth===o||(this.bodyWidth=e,this.leftWidth=i,this.rightWidth=o,t={type:events_1.Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEvent(t))},t.prototype.getValueColumns=function(){return this.valueColumns?this.valueColumns:[]},t.prototype.getPivotColumns=function(){return this.pivotColumns?this.pivotColumns:[]},t.prototype.isPivotActive=function(){return this.pivotColumns&&0<this.pivotColumns.length&&this.pivotMode},t.prototype.getRowGroupColumns=function(){return this.rowGroupColumns?this.rowGroupColumns:[]},t.prototype.getDisplayedCenterColumns=function(){return this.displayedCenterColumns},t.prototype.getDisplayedLeftColumns=function(){return this.displayedLeftColumns},t.prototype.getDisplayedRightColumns=function(){return this.displayedRightColumns},t.prototype.getDisplayedColumns=function(t){switch(t){case column_1.Column.PINNED_LEFT:return this.getDisplayedLeftColumns();case column_1.Column.PINNED_RIGHT:return this.getDisplayedRightColumns();default:return this.getDisplayedCenterColumns()}},t.prototype.getAllPrimaryColumns=function(){return this.primaryColumns?this.primaryColumns.slice():null},t.prototype.getSecondaryColumns=function(){return this.secondaryColumns?this.secondaryColumns.slice():null},t.prototype.getAllColumnsForQuickFilter=function(){return this.columnsForQuickFilter},t.prototype.getAllGridColumns=function(){return this.gridColumns},t.prototype.isEmpty=function(){return utils_1._.missingOrEmpty(this.gridColumns)},t.prototype.isRowGroupEmpty=function(){return utils_1._.missingOrEmpty(this.rowGroupColumns)},t.prototype.setColumnVisible=function(t,e,i){void 0===i&&(i="api"),this.setColumnsVisible([t],e,i)},t.prototype.setColumnsVisible=function(t,e,i){var o=this;void 0===i&&(i="api"),this.columnAnimationService.start(),this.actionOnGridColumns(t,function(t){return t.isVisible()!==e&&(t.setVisible(e,i),!0)},i,function(){return{type:events_1.Events.EVENT_COLUMN_VISIBLE,visible:e,column:null,columns:null,api:o.gridApi,columnApi:o.columnApi,source:i}}),this.columnAnimationService.finish()},t.prototype.setColumnPinned=function(t,e,i){void 0===i&&(i="api"),t&&this.setColumnsPinned([t],e,i)},t.prototype.setColumnsPinned=function(t,e,i){var o,n=this;void 0===i&&(i="api"),"print"!==this.gridOptionsWrapper.getDomLayout()?(this.columnAnimationService.start(),o=!0===e||e===column_1.Column.PINNED_LEFT?column_1.Column.PINNED_LEFT:e===column_1.Column.PINNED_RIGHT?column_1.Column.PINNED_RIGHT:null,this.actionOnGridColumns(t,function(t){return t.getPinned()!==o&&(t.setPinned(o),!0)},i,function(){return{type:events_1.Events.EVENT_COLUMN_PINNED,pinned:o,column:null,columns:null,api:n.gridApi,columnApi:n.columnApi,source:i}}),this.columnAnimationService.finish()):console.warn("Changing the column pinning status is not allowed with domLayout='print'")},t.prototype.actionOnGridColumns=function(t,i,e,o){var n,s,r=this;utils_1._.missingOrEmpty(t)||(n=[],t.forEach(function(t){var e=r.getGridColumn(t);e&&!1!==i(e)&&n.push(e)}),0!==n.length&&(this.updateDisplayedColumns(e),utils_1._.exists(o)&&o&&((s=o()).columns=n,s.column=1===n.length?n[0]:null,this.eventService.dispatchEvent(s))))},t.prototype.getDisplayedColBefore=function(t){var e=this.getAllDisplayedColumns(),i=e.indexOf(t);return 0<i?e[i-1]:null},t.prototype.getDisplayedColAfter=function(t){var e=this.getAllDisplayedColumns(),i=e.indexOf(t);return i<e.length-1?e[i+1]:null},t.prototype.getDisplayedGroupAfter=function(t){for(var e=t.getDisplayedLeafColumns()[0],i=t.getOriginalColumnGroup().getLevel();;){if(!(e=this.getDisplayedColAfter(e)))return null;for(var o=e.getParent();o.getOriginalColumnGroup().getLevel()!==i;)o=o.getParent();if(o!==t)return o}},t.prototype.isPinningLeft=function(){return 0<this.displayedLeftColumns.length},t.prototype.isPinningRight=function(){return 0<this.displayedRightColumns.length},t.prototype.getPrimaryAndSecondaryAndAutoColumns=function(){var e=this.primaryColumns?this.primaryColumns.slice(0):[];return this.groupAutoColumns&&utils_1._.exists(this.groupAutoColumns)&&this.groupAutoColumns.forEach(function(t){return e.push(t)}),this.secondaryColumnsPresent&&this.secondaryColumns&&this.secondaryColumns.forEach(function(t){return e.push(t)}),e},t.prototype.createStateItemFromColumn=function(t){var e=t.isRowGroupActive()?this.rowGroupColumns.indexOf(t):null,i=t.isPivotActive()?this.pivotColumns.indexOf(t):null,o=t.isValueActive()?t.getAggFunc():null;return{colId:t.getColId(),hide:!t.isVisible(),aggFunc:o,width:t.getActualWidth(),pivotIndex:i,pinned:t.getPinned(),rowGroupIndex:e}},t.prototype.getColumnState=function(){if(utils_1._.missing(this.primaryColumns))return[];var t=this.primaryColumns.map(this.createStateItemFromColumn.bind(this)),e=(this.groupAutoColumns?this.groupAutoColumns.map(this.createStateItemFromColumn.bind(this)):[]).concat(t);return this.pivotMode||this.orderColumnStateList(e),e},t.prototype.orderColumnStateList=function(t){var i=this.gridColumns.map(function(t){return t.getColId()});t.sort(function(t,e){return i.indexOf(t.colId)-i.indexOf(e.colId)})},t.prototype.resetColumnState=function(t,e){void 0===t&&(t=!1),void 0===e&&(e="api");var i=this.getColumnsFromTree(this.primaryColumnTree),r=[],u=1e3,l=1e3;i&&i.forEach(function(t){var e=t.getColDef().rowGroupIndex,i=t.getColDef().rowGroup,o=t.getColDef().pivotIndex,n=t.getColDef().pivot,s={colId:t.getColId(),aggFunc:t.getColDef().aggFunc,hide:t.getColDef().hide,pinned:t.getColDef().pinned,rowGroupIndex:e,pivotIndex:t.getColDef().pivotIndex,width:t.getColDef().width};utils_1._.missing(e)&&i&&(s.rowGroupIndex=u++),utils_1._.missing(o)&&n&&(s.pivotIndex=l++),r.push(s)}),this.setColumnState(r,t,e)},t.prototype.setColumnState=function(t,e,i){var o=this;if(void 0===e&&(e=!1),void 0===i&&(i="api"),utils_1._.missingOrEmpty(this.primaryColumns))return!1;var n=this.getColumnState();this.autoGroupsNeedBuilding=!0;var s=this.primaryColumns.slice();this.rowGroupColumns=[],this.valueColumns=[],this.pivotColumns=[];var r,u,l=!0,a={},p={},d=[];return t&&t.forEach(function(t){var e;utils_1._.exists(o.getAutoColumn(t.colId))?d.push(t):(e=o.getPrimaryColumn(t.colId))?(o.syncColumnWithStateItem(e,t,a,p,i),utils_1._.removeFromArray(s,e)):(console.warn("ag-grid: column "+t.colId+" not found"),l=!1)}),s.forEach(this.syncColumnWithNoState.bind(this)),this.rowGroupColumns.sort(this.sortColumnListUsingIndexes.bind(this,a)),this.pivotColumns.sort(this.sortColumnListUsingIndexes.bind(this,p)),this.updateGridColumns(),d.forEach(function(t){var e=o.getAutoColumn(t.colId);o.syncColumnWithStateItem(e,t,a,p,i)}),t&&(r=t.map(function(t){return t.colId}),this.gridColumns.sort(function(t,e){return r.indexOf(t.getId())-r.indexOf(e.getId())})),this.putFixedColumnsFirst(),this.updateDisplayedColumns(i),e||(u={type:events_1.Events.EVENT_COLUMN_EVERYTHING_CHANGED,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(u)),this.raiseColumnEvents(n,i),l},t.prototype.raiseColumnEvents=function(s,n){var r,t,e,i,u=this;this.gridOptionsWrapper.isSuppressSetColumnStateEvents()||(r=this.getColumnState(),e=function(i){var o=[],n={};return s.forEach(function(t){n[t.colId]=t}),u.gridColumns.forEach(function(t){var e=n[t.getColId()];e&&!i(e,t)||o.push(t)}),o},(t=function(t,e,i){var o;utils_1._.compareArrays(s.map(e).sort(),r.map(e).sort())||(o={type:t,columns:i,column:1===i.length?i[0]:null,api:u.gridApi,columnApi:u.columnApi,source:n},u.eventService.dispatchEvent(o))})(events_1.Events.EVENT_COLUMN_VALUE_CHANGED,function(t){return t.colId+"-"+t.aggFunc},this.valueColumns),t(events_1.Events.EVENT_COLUMN_PIVOT_CHANGED,function(t){return t.colId+"-"+t.pivotIndex},this.pivotColumns),t(events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,function(t){return t.colId+"-"+t.rowGroupIndex},this.rowGroupColumns),this.raiseColumnPinnedEvent(e(function(t,e){return t.pinned!==e.getPinned()}),n),i=e(function(t,e){return t.hide===e.isVisible()}),this.raiseColumnVisibleEvent(i,n),this.raiseColumnResizeEvent(e(function(t,e){return t.width!==e.getActualWidth()}),n),this.raiseColumnMovedEvent(s,n))},t.prototype.raiseColumnPinnedEvent=function(t,e){var i;0<t.length&&(i={type:events_1.Events.EVENT_COLUMN_PINNED,pinned:null,columns:t,column:null,api:this.gridApi,columnApi:this.columnApi,source:e},this.eventService.dispatchEvent(i))},t.prototype.raiseColumnVisibleEvent=function(t,e){var i;0<t.length&&(i={type:events_1.Events.EVENT_COLUMN_VISIBLE,visible:void 0,columns:t,column:null,api:this.gridApi,columnApi:this.columnApi,source:e},this.eventService.dispatchEvent(i))},t.prototype.raiseColumnResizeEvent=function(t,e){var i;0<t.length&&(i={type:events_1.Events.EVENT_COLUMN_RESIZED,columns:t,column:null,finished:!0,api:this.gridApi,columnApi:this.columnApi,source:e},this.eventService.dispatchEvent(i))},t.prototype.raiseColumnMovedEvent=function(n,t){for(var e,s=[],r=this.getColumnState(),i=function(t){var e,i=n[t],o=r[t];if(!i||o.hide)return"continue";i.colId!==o.colId&&(e=utils_1._.find(u.allDisplayedColumns,function(t){return t.getColId()===o.colId}),s.push(e))},u=this,o=0;o<r.length;o++)i(o);0<s.length&&(e={type:events_1.Events.EVENT_COLUMN_MOVED,columns:s,column:null,toIndex:void 0,api:this.gridApi,columnApi:this.columnApi,source:t},this.eventService.dispatchEvent(e))},t.prototype.sortColumnListUsingIndexes=function(t,e,i){return t[e.getId()]-t[i.getId()]},t.prototype.syncColumnWithNoState=function(t,e){t.setVisible(!1,e),t.setAggFunc(null),t.setPinned(null),t.setRowGroupActive(!1,e),t.setPivotActive(!1,e),t.setValueActive(!1,e)},t.prototype.syncColumnWithStateItem=function(t,e,i,o,n){var s;t&&(t.setVisible(!e.hide,n),t.setPinned(e.pinned),s=this.gridOptionsWrapper.getMinColWidth(),e.width&&s&&e.width>=s&&t.setActualWidth(e.width,n),"string"==typeof e.aggFunc?(t.setAggFunc(e.aggFunc),t.setValueActive(!0,n),this.valueColumns.push(t)):(utils_1._.exists(e.aggFunc)&&console.warn("ag-Grid: stateItem.aggFunc must be a string. if using your own aggregation functions, register the functions first before using them in get/set state. This is because it isintended for the column state to be stored and retrieved as simple JSON."),t.setAggFunc(null),t.setValueActive(!1,n)),"number"==typeof e.rowGroupIndex?(this.rowGroupColumns.push(t),t.setRowGroupActive(!0,n),i[t.getId()]=e.rowGroupIndex):t.setRowGroupActive(!1,n),"number"==typeof e.pivotIndex?(this.pivotColumns.push(t),t.setPivotActive(!0,n),o[t.getId()]=e.pivotIndex):t.setPivotActive(!1,n))},t.prototype.getGridColumns=function(t){return this.getColumns(t,this.getGridColumn.bind(this))},t.prototype.getColumns=function(t,i){var o=[];return t&&t.forEach(function(t){var e=i(t);e&&o.push(e)}),o},t.prototype.getColumnWithValidation=function(t){if(null==t)return null;var e=this.getGridColumn(t);return e||console.warn("ag-Grid: could not find column "+t),e},t.prototype.getPrimaryColumn=function(t){return this.getColumn(t,this.primaryColumns)},t.prototype.getGridColumn=function(t){return this.getColumn(t,this.gridColumns)},t.prototype.getColumn=function(t,e){if(!t)return null;for(var i=0;i<e.length;i++)if(this.columnsMatch(e[i],t))return e[i];return this.getAutoColumn(t)},t.prototype.getAutoColumn=function(e){var i=this;return this.groupAutoColumns&&utils_1._.exists(this.groupAutoColumns)&&!utils_1._.missing(this.groupAutoColumns)?utils_1._.find(this.groupAutoColumns,function(t){return i.columnsMatch(t,e)}):null},t.prototype.columnsMatch=function(t,e){var i=t===e,o=t.getColDef()===e,n=t.getColId()==e;return i||o||n},t.prototype.getDisplayNameForColumn=function(t,e,i){if(void 0===i&&(i=!1),!t)return null;var o=this.getHeaderName(t.getColDef(),t,null,null,e);return i?this.wrapHeaderNameWithAggFunc(t,o):o},t.prototype.getDisplayNameForOriginalColumnGroup=function(t,e,i){var o=e?e.getColGroupDef():null;return o?this.getHeaderName(o,null,t,e,i):null},t.prototype.getDisplayNameForColumnGroup=function(t,e){return this.getDisplayNameForOriginalColumnGroup(t,t.getOriginalColumnGroup(),e)},t.prototype.getHeaderName=function(t,e,i,o,n){var s=t.headerValueGetter;if(s){var r={colDef:t,column:e,columnGroup:i,originalColumnGroup:o,location:n,api:this.gridOptionsWrapper.getApi(),context:this.gridOptionsWrapper.getContext()};return"function"==typeof s?s(r):"string"==typeof s?this.expressionService.evaluate(s,r):(console.warn("ag-grid: headerValueGetter must be a function or a string"),"")}return null!=t.headerName?t.headerName:t.field?utils_1._.camelCaseToHumanText(t.field):""},t.prototype.wrapHeaderNameWithAggFunc=function(t,e){if(this.gridOptionsWrapper.isSuppressAggFuncInHeader())return e;var i,o,n=t.getColDef().pivotValueColumn,s=null;if(utils_1._.exists(n)?(s=n?n.getAggFunc():null,!0):(i=t.isValueActive(),o=this.pivotMode||!this.isRowGroupEmpty(),!(!i||!o)&&(s=t.getAggFunc(),!0))){var r="string"==typeof s?s:"func";return this.gridOptionsWrapper.getLocaleTextFunc()(r,r)+"("+e+")"}return e},t.prototype.getColumnGroup=function(i,o){if(!i)return null;if(i instanceof columnGroup_1.ColumnGroup)return i;var t=this.getAllDisplayedColumnGroups(),n="number"==typeof o,s=null;return this.columnUtils.depthFirstAllColumnTreeSearch(t,function(t){var e;t instanceof columnGroup_1.ColumnGroup&&(e=t,(n?i===e.getGroupId()&&o===e.getInstanceId():i===e.getGroupId())&&(s=e))}),s},t.prototype.isReady=function(){return this.ready},t.prototype.createValueColumns=function(i,t){this.valueColumns=this.extractColumns(t,this.valueColumns,function(t,e){return t.setValueActive(e,i)},function(){return null},function(t){return!!t.aggFunc}),this.valueColumns.forEach(function(t){t.getAggFunc()||t.setAggFunc(t.getColDef().aggFunc)})},t.prototype.extractRowGroupColumns=function(i,t){this.rowGroupColumns=this.extractColumns(t,this.rowGroupColumns,function(t,e){return t.setRowGroupActive(e,i)},function(t){return t.rowGroupIndex},function(t){return t.rowGroup})},t.prototype.extractColumns=function(e,t,i,n,o){var s=this,r=(t=t||[]).filter(function(t){return s.primaryColumns.indexOf(t)<0}),u=t.filter(function(t){return 0<=s.primaryColumns.indexOf(t)}),l=this.primaryColumns.filter(function(t){return!e||e.indexOf(t)<0});r.forEach(function(t){return i(t,!1)});var a=[];return l.forEach(function(t){"number"==typeof n(t.getColDef())&&a.push(t)}),a.sort(function(t,e){var i=n(t.getColDef()),o=n(e.getColDef());return i===o?0:i<o?-1:1}),l.forEach(function(t){if(o(t.getColDef())){if(0<=a.indexOf(t))return;a.push(t)}}),a.forEach(function(t){return i(t,!0)}),u.concat(a)},t.prototype.extractPivotColumns=function(i,t){this.pivotColumns=this.extractColumns(t,this.pivotColumns,function(t,e){return t.setPivotActive(e,i)},function(t){return t.pivotIndex},function(t){return t.pivot})},t.prototype.resetColumnGroupState=function(t){void 0===t&&(t="api");var i=[];this.columnUtils.depthFirstOriginalTreeSearch(null,this.primaryColumnTree,function(t){var e;t instanceof originalColumnGroup_1.OriginalColumnGroup&&(e={groupId:t.getGroupId(),open:t.getColGroupDef().openByDefault},i.push(e))}),this.setColumnGroupState(i,t)},t.prototype.getColumnGroupState=function(){var i=[];return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(t){var e;t instanceof originalColumnGroup_1.OriginalColumnGroup&&(e=t,i.push({groupId:e.getGroupId(),open:e.isExpanded()}))}),i},t.prototype.setColumnGroupState=function(t,e){var n=this;void 0===e&&(e="api"),this.columnAnimationService.start();var s=[];t.forEach(function(t){var e=t.groupId,i=t.open,o=n.getOriginalColumnGroup(e);o&&o.isExpanded()!==i&&(n.logger.log("columnGroupOpened("+o.getGroupId()+","+i+")"),o.setExpanded(i),s.push(o))}),this.updateGroupsAndDisplayedColumns(e),this.setFirstRightAndLastLeftPinned(e),s.forEach(function(t){var e={type:events_1.Events.EVENT_COLUMN_GROUP_OPENED,columnGroup:t,api:n.gridApi,columnApi:n.columnApi};n.eventService.dispatchEvent(e)}),this.columnAnimationService.finish()},t.prototype.setColumnGroupOpened=function(t,e,i){var o;void 0===i&&(i="api"),o=t instanceof originalColumnGroup_1.OriginalColumnGroup?t.getId():t,this.setColumnGroupState([{groupId:o,open:e}],i)},t.prototype.getOriginalColumnGroup=function(i){if(i instanceof originalColumnGroup_1.OriginalColumnGroup)return i;"string"!=typeof i&&console.error("ag-Grid: group key must be a string");var o=null;return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(t){var e;t instanceof originalColumnGroup_1.OriginalColumnGroup&&((e=t).getId()===i&&(o=e))}),o},t.prototype.calculateColumnsForDisplay=function(){var o=this,t=this.pivotMode&&!this.secondaryColumnsPresent?utils_1._.filter(this.gridColumns,function(t){var e=o.groupAutoColumns&&0<=o.groupAutoColumns.indexOf(t),i=o.valueColumns&&0<=o.valueColumns.indexOf(t);return e||i}):utils_1._.filter(this.gridColumns,function(t){return o.groupAutoColumns&&0<=o.groupAutoColumns.indexOf(t)||t.isVisible()});return t},t.prototype.checkColSpanActiveInCols=function(t){var e=!1;return t.forEach(function(t){utils_1._.exists(t.getColDef().colSpan)&&(e=!0)}),e},t.prototype.calculateColumnsForGroupDisplay=function(){var i=this;this.groupDisplayColumns=[];function t(t){var e=t.getColDef();e&&utils_1._.exists(e.showRowGroup)&&i.groupDisplayColumns.push(t)}this.gridColumns.forEach(t),this.groupAutoColumns&&this.groupAutoColumns.forEach(t)},t.prototype.getGroupDisplayColumns=function(){return this.groupDisplayColumns},t.prototype.updateDisplayedColumns=function(t){var e=this.calculateColumnsForDisplay();this.buildDisplayedTrees(e),this.calculateColumnsForGroupDisplay(),this.updateGroupsAndDisplayedColumns(t),this.setFirstRightAndLastLeftPinned(t)},t.prototype.isSecondaryColumnsPresent=function(){return this.secondaryColumnsPresent},t.prototype.setSecondaryColumns=function(t,e){void 0===e&&(e="api");var i,o=t&&0<t.length;(o||this.secondaryColumnsPresent)&&(o?(this.processSecondaryColumnDefinitions(t),i=this.columnFactory.createColumnTree(t,!1),this.secondaryBalancedTree=i.columnTree,this.secondaryHeaderRowCount=i.treeDept+1,this.secondaryColumns=this.getColumnsFromTree(this.secondaryBalancedTree),this.secondaryColumnsPresent=!0):(this.secondaryBalancedTree=null,this.secondaryHeaderRowCount=-1,this.secondaryColumns=null,this.secondaryColumnsPresent=!1),this.updateGridColumns(),this.updateDisplayedColumns(e))},t.prototype.processSecondaryColumnDefinitions=function(t){var s=this.gridOptionsWrapper.getProcessSecondaryColDefFunc(),r=this.gridOptionsWrapper.getProcessSecondaryColGroupDefFunc();(s||r)&&t&&!function n(t){t.forEach(function(t){var e,i,o=utils_1._.exists(t.children);o?(e=t,r&&r(e),n(e.children)):(i=t,s&&s(i))})}(t)},t.prototype.updateGridColumns=function(){this.gridColsArePrimary&&(this.lastPrimaryOrder=this.gridColumns),this.secondaryColumns&&this.secondaryBalancedTree?(this.gridBalancedTree=this.secondaryBalancedTree.slice(),this.gridHeaderRowCount=this.secondaryHeaderRowCount,this.gridColumns=this.secondaryColumns.slice(),this.gridColsArePrimary=!1):(this.gridBalancedTree=this.primaryColumnTree.slice(),this.gridHeaderRowCount=this.primaryHeaderRowCount,this.gridColumns=this.primaryColumns.slice(),this.gridColsArePrimary=!0,this.orderGridColsLikeLastPrimary()),this.addAutoGroupToGridColumns(),this.autoRowHeightColumns=this.gridColumns.filter(function(t){return t.getColDef().autoHeight}),this.putFixedColumnsFirst(),this.setupQuickFilterColumns(),this.clearDisplayedColumns(),this.colSpanActive=this.checkColSpanActiveInCols(this.gridColumns);var t={type:events_1.Events.EVENT_GRID_COLUMNS_CHANGED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(t)},t.prototype.orderGridColsLikeLastPrimary=function(){var e,i,t,s,o=this;utils_1._.missing(this.lastPrimaryOrder)||(e=!0,this.gridColumns.forEach(function(t){0<=o.lastPrimaryOrder.indexOf(t)&&(e=!1)}),e||(i=this.lastPrimaryOrder.filter(function(t){return 0<=o.gridColumns.indexOf(t)}),t=this.gridColumns.filter(function(t){return i.indexOf(t)<0}),s=i.slice(),t.forEach(function(t){var e=t.getOriginalParent();if(e){for(var i,o,n=[];!n.length&&e;){e.getLeafColumns().forEach(function(t){var e=0<=s.indexOf(t),i=n.indexOf(t)<0;e&&i&&n.push(t)}),e=e.getOriginalParent()}n.length?(i=n.map(function(t){return s.indexOf(t)}),o=Math.max.apply(Math,i),utils_1._.insertIntoArray(s,t,o+1)):s.push(t)}else s.push(t)}),this.gridColumns=s))},t.prototype.isPrimaryColumnGroupsPresent=function(){return 1<this.primaryHeaderRowCount},t.prototype.setupQuickFilterColumns=function(){this.groupAutoColumns?this.columnsForQuickFilter=this.primaryColumns.concat(this.groupAutoColumns):this.columnsForQuickFilter=this.primaryColumns},t.prototype.putFixedColumnsFirst=function(){var t=this.gridColumns.filter(function(t){return t.getColDef().lockPosition}),e=this.gridColumns.filter(function(t){return!t.getColDef().lockPosition});this.gridColumns=t.concat(e)},t.prototype.addAutoGroupToGridColumns=function(){var t;this.createGroupAutoColumnsIfNeeded(),utils_1._.missing(this.groupAutoColumns)||(this.gridColumns=this.groupAutoColumns?this.groupAutoColumns.concat(this.gridColumns):this.gridColumns,t=this.columnFactory.createForAutoGroups(this.groupAutoColumns,this.gridBalancedTree),this.gridBalancedTree=t.concat(this.gridBalancedTree))},t.prototype.clearDisplayedColumns=function(){this.displayedLeftColumnTree=[],this.displayedRightColumnTree=[],this.displayedCentreColumnTree=[],this.displayedLeftHeaderRows={},this.displayedRightHeaderRows={},this.displayedCentreHeaderRows={},this.displayedLeftColumns=[],this.displayedRightColumns=[],this.displayedCenterColumns=[],this.allDisplayedColumns=[],this.allDisplayedVirtualColumns=[]},t.prototype.updateGroupsAndDisplayedColumns=function(t){this.updateOpenClosedVisibilityInColumnGroups(),this.updateDisplayedColumnsFromTrees(t),this.updateVirtualSets(),this.updateBodyWidths();var e={type:events_1.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(e)},t.prototype.updateDisplayedColumnsFromTrees=function(t){this.addToDisplayedColumns(this.displayedLeftColumnTree,this.displayedLeftColumns),this.addToDisplayedColumns(this.displayedCentreColumnTree,this.displayedCenterColumns),this.addToDisplayedColumns(this.displayedRightColumnTree,this.displayedRightColumns),this.setupAllDisplayedColumns(),this.setLeftValues(t)},t.prototype.setupAllDisplayedColumns=function(){this.gridOptionsWrapper.isEnableRtl()?this.allDisplayedColumns=this.displayedRightColumns.concat(this.displayedCenterColumns).concat(this.displayedLeftColumns):this.allDisplayedColumns=this.displayedLeftColumns.concat(this.displayedCenterColumns).concat(this.displayedRightColumns)},t.prototype.setLeftValues=function(t){this.setLeftValuesOfColumns(t),this.setLeftValuesOfGroups()},t.prototype.setLeftValuesOfColumns=function(o){var n=this,s=this.primaryColumns.slice(0),r=this.gridOptionsWrapper.isEnableRtl();[this.displayedLeftColumns,this.displayedRightColumns,this.displayedCenterColumns].forEach(function(t){var e,i;r?(e=n.getWidthOfColsInList(t),t.forEach(function(t){e-=t.getActualWidth(),t.setLeft(e,o)})):(i=0,t.forEach(function(t){t.setLeft(i,o),i+=t.getActualWidth()})),utils_1._.removeAllFromArray(s,t)}),s.forEach(function(t){t.setLeft(null,o)})},t.prototype.setLeftValuesOfGroups=function(){[this.displayedLeftColumnTree,this.displayedRightColumnTree,this.displayedCentreColumnTree].forEach(function(t){t.forEach(function(t){t instanceof columnGroup_1.ColumnGroup&&t.checkLeft()})})},t.prototype.addToDisplayedColumns=function(t,e){e.length=0,this.columnUtils.depthFirstDisplayedColumnTreeSearch(t,function(t){t instanceof column_1.Column&&e.push(t)})},t.prototype.updateDisplayedCenterVirtualColumns=function(){this.suppressColumnVirtualisation?this.allDisplayedCenterVirtualColumns=this.displayedCenterColumns:this.allDisplayedCenterVirtualColumns=this.filterOutColumnsWithinViewport(),this.allDisplayedVirtualColumns=this.allDisplayedCenterVirtualColumns.concat(this.displayedLeftColumns).concat(this.displayedRightColumns);var e={};return this.allDisplayedVirtualColumns.forEach(function(t){e[t.getId()]=!0}),e},t.prototype.getVirtualHeaderGroupRow=function(t,e){var i;switch(t){case column_1.Column.PINNED_LEFT:i=this.displayedLeftHeaderRows[e];break;case column_1.Column.PINNED_RIGHT:i=this.displayedRightHeaderRows[e];break;default:i=this.displayedCentreHeaderRows[e]}return utils_1._.missing(i)&&(i=[]),i},t.prototype.updateDisplayedVirtualGroups=function(r){function u(t,e,i){for(var o=!1,n=0;n<t.length;n++){var s=t[n];(s instanceof column_1.Column?!0===r[s.getId()]:u(s.getDisplayedChildren(),e,i+1))&&(o=!0,e[i]||(e[i]=[]),e[i].push(s))}return o}this.displayedLeftHeaderRows={},this.displayedRightHeaderRows={},this.displayedCentreHeaderRows={},u(this.displayedLeftColumnTree,this.displayedLeftHeaderRows,0),u(this.displayedRightColumnTree,this.displayedRightHeaderRows,0),u(this.displayedCentreColumnTree,this.displayedCentreHeaderRows,0)},t.prototype.updateVirtualSets=function(){var t=this.updateDisplayedCenterVirtualColumns();this.updateDisplayedVirtualGroups(t)},t.prototype.filterOutColumnsWithinViewport=function(){return utils_1._.filter(this.displayedCenterColumns,this.isColumnInViewport.bind(this))},t.prototype.sizeColumnsToFit=function(t,e){var i=this;void 0===e&&(e="api");var o=this.getAllDisplayedColumns();if(!(t<=0||0===o.length)){for(var n=utils_1._.filter(o,function(t){return!0===t.getColDef().suppressSizeToFit}),s=utils_1._.filter(o,function(t){return!0!==t.getColDef().suppressSizeToFit}),r=s.slice(0),u=!1;!u;){u=!0;var l=t-this.getWidthOfColsInList(n);if(l<=0)s.forEach(function(t){t.setMinimum(e)});else for(var a=l/this.getWidthOfColsInList(s),p=l,d=s.length-1;0<=d;d--){var h=s[d],c=Math.round(h.getActualWidth()*a);c<h.getMinWidth()?(h.setMinimum(e),m(h),u=!1):h.isGreaterThanMax(c)?(h.setActualWidth(h.getMaxWidth(),e),m(h),u=!1):0===d?h.setActualWidth(p,e):h.setActualWidth(c,e),p-=c}}this.setLeftValues(e),this.updateBodyWidths(),r.forEach(function(t){var e={type:events_1.Events.EVENT_COLUMN_RESIZED,column:t,columns:[t],finished:!0,api:i.gridApi,columnApi:i.columnApi,source:"sizeColumnsToFit"};i.eventService.dispatchEvent(e)})}function m(t){utils_1._.removeFromArray(s,t),n.push(t)}},t.prototype.buildDisplayedTrees=function(t){var e=utils_1._.filter(t,function(t){return"left"===t.getPinned()}),i=utils_1._.filter(t,function(t){return"right"===t.getPinned()}),o=utils_1._.filter(t,function(t){return"left"!==t.getPinned()&&"right"!==t.getPinned()}),n=new groupInstanceIdCreator_1.GroupInstanceIdCreator;this.displayedLeftColumnTree=this.displayedGroupCreator.createDisplayedGroups(e,this.gridBalancedTree,n,column_1.Column.PINNED_LEFT,this.displayedLeftColumnTree),this.displayedRightColumnTree=this.displayedGroupCreator.createDisplayedGroups(i,this.gridBalancedTree,n,column_1.Column.PINNED_RIGHT,this.displayedRightColumnTree),this.displayedCentreColumnTree=this.displayedGroupCreator.createDisplayedGroups(o,this.gridBalancedTree,n,null,this.displayedCentreColumnTree)},t.prototype.updateOpenClosedVisibilityInColumnGroups=function(){var t=this.getAllDisplayedColumnGroups();this.columnUtils.depthFirstAllColumnTreeSearch(t,function(t){t instanceof columnGroup_1.ColumnGroup&&t.calculateDisplayedColumns()})},t.prototype.getGroupAutoColumns=function(){return this.groupAutoColumns},t.prototype.createGroupAutoColumnsIfNeeded=function(){var t,e,i,o;this.autoGroupsNeedBuilding&&(this.autoGroupsNeedBuilding=!1,t=this.gridOptionsWrapper.isGroupUseEntireRow(this.pivotMode),e=this.gridOptionsWrapper.isGroupSuppressAutoColumn()&&!this.pivotMode,i=this.gridOptionsWrapper.isGroupSuppressRow(),(0<this.rowGroupColumns.length||this.usingTreeData)&&!e&&!t&&!i?(o=this.autoGroupColService.createAutoGroupColumns(this.rowGroupColumns),this.autoColsEqual(o,this.groupAutoColumns)||(this.groupAutoColumns=o)):this.groupAutoColumns=null)},t.prototype.autoColsEqual=function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++){var o=t[i],n=e[i];if(o.getColId()!==n.getColId())return!1}return!0},t.prototype.getWidthOfColsInList=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i].getActualWidth();return e},t.prototype.getGridBalancedTree=function(){return this.gridBalancedTree},__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],t.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("expressionService"),__metadata("design:type",expressionService_1.ExpressionService)],t.prototype,"expressionService",void 0),__decorate([context_1.Autowired("columnFactory"),__metadata("design:type",columnFactory_1.ColumnFactory)],t.prototype,"columnFactory",void 0),__decorate([context_1.Autowired("displayedGroupCreator"),__metadata("design:type",displayedGroupCreator_1.DisplayedGroupCreator)],t.prototype,"displayedGroupCreator",void 0),__decorate([context_1.Autowired("autoWidthCalculator"),__metadata("design:type",autoWidthCalculator_1.AutoWidthCalculator)],t.prototype,"autoWidthCalculator",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],t.prototype,"eventService",void 0),__decorate([context_1.Autowired("columnUtils"),__metadata("design:type",columnUtils_1.ColumnUtils)],t.prototype,"columnUtils",void 0),__decorate([context_1.Autowired("context"),__metadata("design:type",context_1.Context)],t.prototype,"context",void 0),__decorate([context_1.Autowired("columnAnimationService"),__metadata("design:type",columnAnimationService_1.ColumnAnimationService)],t.prototype,"columnAnimationService",void 0),__decorate([context_1.Autowired("autoGroupColService"),__metadata("design:type",autoGroupColService_1.AutoGroupColService)],t.prototype,"autoGroupColService",void 0),__decorate([context_1.Optional("aggFuncService"),__metadata("design:type",Object)],t.prototype,"aggFuncService",void 0),__decorate([context_1.Optional("valueCache"),__metadata("design:type",valueCache_1.ValueCache)],t.prototype,"valueCache",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],t.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],t.prototype,"gridApi",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"init",null),__decorate([__param(0,context_1.Qualifier("loggerFactory")),__metadata("design:type",Function),__metadata("design:paramtypes",[logger_1.LoggerFactory]),__metadata("design:returntype",void 0)],t.prototype,"setBeans",null),t=__decorate([context_1.Bean("columnController")],t)}();exports.ColumnController=ColumnController;