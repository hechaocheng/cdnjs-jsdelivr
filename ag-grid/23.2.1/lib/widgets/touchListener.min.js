"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var eventService_1=require("../eventService"),utils_1=require("../utils"),TouchListener=function(){function s(t,e){var i=this;void 0===e&&(e=!1),this.destroyFuncs=[],this.touching=!1,this.eventService=new eventService_1.EventService,this.eElement=t,this.preventMouseClick=e;var n=this.onTouchStart.bind(this),o=this.onTouchMove.bind(this),s=this.onTouchEnd.bind(this);this.eElement.addEventListener("touchstart",n,{passive:!0}),this.eElement.addEventListener("touchmove",o,{passive:!0}),this.eElement.addEventListener("touchend",s,{passive:!1}),this.destroyFuncs.push(function(){i.eElement.removeEventListener("touchstart",n,{passive:!0}),i.eElement.removeEventListener("touchmove",o,{passive:!0}),i.eElement.removeEventListener("touchend",s,{passive:!1})})}return s.prototype.getActiveTouch=function(t){for(var e=0;e<t.length;e++){if(t[e].identifier===this.touchStart.identifier)return t[e]}return null},s.prototype.addEventListener=function(t,e){this.eventService.addEventListener(t,e)},s.prototype.removeEventListener=function(t,e){this.eventService.removeEventListener(t,e)},s.prototype.onTouchStart=function(i){var n,o=this;this.touching||(this.touchStart=i.touches[0],this.touching=!0,this.moved=!1,n=this.touchStart,window.setTimeout(function(){var t,e=o.touchStart===n;o.touching&&e&&!o.moved&&(o.moved=!0,t={type:s.EVENT_LONG_TAP,touchStart:o.touchStart,touchEvent:i},o.eventService.dispatchEvent(t))},500))},s.prototype.onTouchMove=function(t){var e;!this.touching||(e=this.getActiveTouch(t.touches))&&!utils_1._.areEventsNear(e,this.touchStart,4)&&(this.moved=!0)},s.prototype.onTouchEnd=function(t){var e;this.touching&&(this.moved||(e={type:s.EVENT_TAP,touchStart:this.touchStart},this.eventService.dispatchEvent(e),this.checkForDoubleTap()),this.preventMouseClick&&t.preventDefault(),this.touching=!1)},s.prototype.checkForDoubleTap=function(){var t,e,i=(new Date).getTime();this.lastTapTime&&0<this.lastTapTime?(t=i-this.lastTapTime,s.DOUBLE_TAP_MILLIS<t?(e={type:s.EVENT_DOUBLE_TAP,touchStart:this.touchStart},this.eventService.dispatchEvent(e),this.lastTapTime=null):this.lastTapTime=i):this.lastTapTime=i},s.prototype.destroy=function(){this.destroyFuncs.forEach(function(t){return t()})},s.EVENT_TAP="tap",s.EVENT_DOUBLE_TAP="doubleTap",s.EVENT_LONG_TAP="longTap",s.DOUBLE_TAP_MILLIS=500,s}();exports.TouchListener=TouchListener;